!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){n(4),t.exports=n(5)},function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){var i,r;"function"!=typeof Object.defineProperty&&(Object.defineProperty=function(t,e,n){return"value"in n&&(t[e]=n.value),"get"in n&&t.__defineGetter__(e,n.get),"set"in n&&t.__defineSetter__(e,n.set),t}),"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(t,e){for(var n in e)e.hasOwnProperty(n)&&Object.defineProperty(t,n,e[n]);return t}),"function"!=typeof Object.create&&(Object.create=function(t,e){function n(){}n.prototype=t;var i=new n;return null!=e&&Object.defineProperties(i,e),i}),"function"!=typeof Object.getPrototypeOf&&(Object.getPrototypeOf=function(t){return t.__proto__}),"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var n=this,i=Array.prototype.slice.call(arguments,1),r=function(){},o=function(){var o=i.concat(Array.prototype.slice.call(arguments));return n.apply(this instanceof r?this:e||t,o)};return r.prototype=n.prototype,o.prototype=new r,o}),t.getTime=t.performance&&t.performance.now?(i=Date.now(),function(){return i+t.performance.now()}):t.performance&&t.performance.webkitNow?(i=Date.now(),function(){return i+t.performance.webkitNow()}):Date.now,t.requestAnimationFrame=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame||(r=t.getTime(),function(e){return setTimeout((function(){r=t.getTime(),e(r)}),Math.max(0,r+1e3/60-t.getTime()))});var o,s,a,h=function e(i){if(null!=i&&(i instanceof Array||(i=Array.prototype.slice.call(arguments)),i=i.filter((function(t){return[t].join()}))),function e(r,o){var s,a,h=[];for(var c in r)r.hasOwnProperty(c)&&("function"==typeof r[c]?t[c]=r[c]:"object"===n(r[c])&&null!==r[c]&&Object.getPrototypeOf(r[c])===Object.prototype&&(null==i?h.push(c):-1!==(s=i.indexOf(o+c))&&(h.push(c),i.splice(s,1))));for(s=0,a=h.length;s<a;s++)e(r[h[s]],o+h[s]+".")}(e,""),e.Class.getInheritanceTree(t.Game).length<=e.Class.getInheritanceTree(t.Core).length&&(t.Game=t.Core),null!=i&&i.length)throw new Error("Cannot load module: "+i.join(", "))};t.enchant=h,t.addEventListener("message",(function(t,e){try{var n=JSON.parse(t.data);if("event"===n.type)h.Core.instance.dispatchEvent(new h.Event(n.value));else if("debug"===n.type)switch(n.value){case"start":h.Core.instance.start();break;case"pause":h.Core.instance.pause();break;case"resume":h.Core.instance.resume();break;case"tick":h.Core.instance._tick()}}catch(t){}}),!1),(h.Class=function(t,e){return h.Class.create(t,e)}).create=function(t,e){if(null==t&&e)throw new Error("superclass is undefined (enchant.Class.create)");if(null==t)throw new Error("definition is undefined (enchant.Class.create)");if(0===arguments.length)return h.Class.create(Object,e);if(1===arguments.length&&"function"!=typeof arguments[0])return h.Class.create(Object,arguments[0]);for(var i in e)e.hasOwnProperty(i)&&("object"===n(e[i])&&null!==e[i]&&Object.getPrototypeOf(e[i])===Object.prototype?"enumerable"in e[i]||(e[i].enumerable=!0):e[i]={value:e[i],enumerable:!0,writable:!0});var r=function t(){if(!(this instanceof t))return new t;t.prototype.initialize.apply(this,arguments)};r.prototype=Object.create(t.prototype,e),r.prototype.constructor=r,null==r.prototype.initialize&&(r.prototype.initialize=function(){t.apply(this,arguments)});for(var o=this.getInheritanceTree(t),s=0,a=o.length;s<a;s++)if("function"==typeof o[s]._inherited){o[s]._inherited(r);break}return r},h.Class.getInheritanceTree=function(t){for(var e=[],n=t,i=n.prototype;n!==Object;)e.push(n),n=(i=Object.getPrototypeOf(i)).constructor;return e},h.ENV={VERSION:"0.8.3",BROWSER:(s=navigator.userAgent,/Eagle/.test(s)?"eagle":/Opera/.test(s)?"opera":/MSIE|Trident/.test(s)?"ie":/Chrome/.test(s)?"chrome":/(?:Macintosh|Windows).*AppleWebKit/.test(s)?"safari":/(?:iPhone|iPad|iPod).*AppleWebKit/.test(s)?"mobilesafari":/Firefox/.test(s)?"firefox":/Android/.test(s)?"android":""),VENDOR_PREFIX:function(){var t=navigator.userAgent;return-1!==t.indexOf("Opera")?"O":/MSIE|Trident/.test(t)?"ms":-1!==t.indexOf("WebKit")?"webkit":"Gecko"===navigator.product?"Moz":""}(),TOUCH_ENABLED:(o=document.createElement("div"),o.setAttribute("ontouchstart","return"),"function"==typeof o.ontouchstart),RETINA_DISPLAY:function(){if(-1!==navigator.userAgent.indexOf("iPhone")&&2===t.devicePixelRatio){var e=document.querySelector('meta[name="viewport"]');return null==e&&(e=document.createElement("meta"),document.head.appendChild(e)),e.setAttribute("content","width=640"),!0}return!1}(),USE_FLASH_SOUND:function(){var t=navigator.userAgent,e=navigator.vendor||"";return 0===location.href.indexOf("http")&&-1===t.indexOf("Mobile")&&-1!==e.indexOf("Apple")}(),USE_DEFAULT_EVENT_TAGS:["input","textarea","select","area"],CANVAS_DRAWING_METHODS:["putImageData","drawImage","drawFocusRing","fill","stroke","clearRect","fillRect","strokeRect","fillText","strokeText"],KEY_BIND_TABLE:{37:"left",38:"up",39:"right",40:"down"},PREVENT_DEFAULT_KEY_CODES:[37,38,39,40],SOUND_ENABLED_ON_MOBILE_SAFARI:!0,USE_TOUCH_TO_START_SCENE:!0,USE_WEBAUDIO:"file:"!==location.protocol,USE_ANIMATION:!0,COLOR_DETECTION_LEVEL:2},(h.Event=h.Class.create({initialize:function(t){this.type=t,this.target=null,this.x=0,this.y=0,this.localX=0,this.localY=0},_initPosition:function(t,e){var n=h.Core.instance;this.x=this.localX=(t-n._pageX)/n.scale,this.y=this.localY=(e-n._pageY)/n.scale}})).LOAD="load",h.Event.ERROR="error",h.Event.CORE_RESIZE="coreresize",h.Event.PROGRESS="progress",h.Event.ENTER_FRAME="enterframe",h.Event.EXIT_FRAME="exitframe",h.Event.ENTER="enter",h.Event.EXIT="exit",h.Event.CHILD_ADDED="childadded",h.Event.ADDED="added",h.Event.ADDED_TO_SCENE="addedtoscene",h.Event.CHILD_REMOVED="childremoved",h.Event.REMOVED="removed",h.Event.REMOVED_FROM_SCENE="removedfromscene",h.Event.TOUCH_START="touchstart",h.Event.TOUCH_MOVE="touchmove",h.Event.TOUCH_END="touchend",h.Event.RENDER="render",h.Event.INPUT_START="inputstart",h.Event.INPUT_CHANGE="inputchange",h.Event.INPUT_END="inputend",h.Event.INPUT_STATE_CHANGED="inputstatechanged",h.Event.LEFT_BUTTON_DOWN="leftbuttondown",h.Event.LEFT_BUTTON_UP="leftbuttonup",h.Event.RIGHT_BUTTON_DOWN="rightbuttondown",h.Event.RIGHT_BUTTON_UP="rightbuttonup",h.Event.UP_BUTTON_DOWN="upbuttondown",h.Event.UP_BUTTON_UP="upbuttonup",h.Event.DOWN_BUTTON_DOWN="downbuttondown",h.Event.DOWN_BUTTON_UP="downbuttonup",h.Event.A_BUTTON_DOWN="abuttondown",h.Event.A_BUTTON_UP="abuttonup",h.Event.B_BUTTON_DOWN="bbuttondown",h.Event.B_BUTTON_UP="bbuttonup",h.Event.ADDED_TO_TIMELINE="addedtotimeline",h.Event.REMOVED_FROM_TIMELINE="removedfromtimeline",h.Event.ACTION_START="actionstart",h.Event.ACTION_END="actionend",h.Event.ACTION_TICK="actiontick",h.Event.ACTION_ADDED="actionadded",h.Event.ACTION_REMOVED="actionremoved",h.Event.ANIMATION_END="animationend",h.EventTarget=h.Class.create({initialize:function(){this._listeners={}},addEventListener:function(t,e){var n=this._listeners[t];null==n?this._listeners[t]=[e]:-1===n.indexOf(e)&&n.unshift(e)},on:function(){this.addEventListener.apply(this,arguments)},removeEventListener:function(t,e){var n=this._listeners[t];if(null!=n){var i=n.indexOf(e);-1!==i&&n.splice(i,1)}},clearEventListener:function(t){null!=t?delete this._listeners[t]:this._listeners={}},dispatchEvent:function(t){t.target=this,t.localX=t.x-this._offsetX,t.localY=t.y-this._offsetY,null!=this["on"+t.type]&&this["on"+t.type](t);var e=this._listeners[t.type];if(null!=e)for(var n=0,i=(e=e.slice()).length;n<i;n++)e[n].call(this,t)}}),(h.Core=h.Class.create(h.EventTarget,{initialize:function(e,i){if(null===t.document.body)throw new Error("document.body is null. Please excute 'new Core()' in window.onload.");h.EventTarget.call(this);var r=!0;a&&(r=!1,a.stop()),a=h.Core.instance=this,this._calledTime=0,this._mousedownID=0,this._surfaceID=0,this._soundID=0,this._scenes=[],e=e||320,i=i||320;var o,s,c,u=document.getElementById("enchant-stage");if(u){var l=t.getComputedStyle(u);for(s=parseInt(l.width,10),c=parseInt(l.height,10),o=s&&c?Math.min(s/e,c/i):1;u.firstChild;)u.removeChild(u.firstChild);u.style.position="relative";var f=u.getBoundingClientRect();this._pageX=Math.round(t.scrollX||t.pageXOffset+f.left),this._pageY=Math.round(t.scrollY||t.pageYOffset+f.top)}else(u=document.createElement("div")).id="enchant-stage",u.style.position="absolute",document.body.firstChild?document.body.insertBefore(u,document.body.firstChild):document.body.appendChild(u),o=Math.min(t.innerWidth/e,t.innerHeight/i),this._pageX=u.getBoundingClientRect().left,this._pageY=u.getBoundingClientRect().top;for(var d in u.style.fontSize="12px",u.style.webkitTextSizeAdjust="none",u.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)",this._element=u,this.addEventListener("coreresize",this._oncoreresize),this._width=e,this._height=i,this.scale=o,this.fps=30,this.frame=0,this.ready=!1,this.running=!1,this.assets={},this._assets=[],function t(e){for(var i in e.assets&&h.Core.instance.preload(e.assets),e)e.hasOwnProperty(i)&&"object"===n(e[i])&&null!==e[i]&&Object.getPrototypeOf(e[i])===Object.prototype&&t(e[i])}(h),this.currentScene=null,this.rootScene=new h.Scene,this.pushScene(this.rootScene),this.loadingScene=new h.LoadingScene,this._activated=!1,this._offsetX=0,this._offsetY=0,this.input={},this.keyboardInputManager=new h.KeyboardInputManager(t.document,this.input),this.keyboardInputManager.addBroadcastTarget(this),this._keybind=this.keyboardInputManager._binds,h.ENV.KEY_BIND_TABLE||(h.ENV.KEY_BIND_TABLE={}),h.ENV.KEY_BIND_TABLE)this.keybind(d,h.ENV.KEY_BIND_TABLE[d]);r&&(u=h.Core.instance._element,document.addEventListener("keydown",(function(t){a.dispatchEvent(new h.Event("keydown")),-1!==h.ENV.PREVENT_DEFAULT_KEY_CODES.indexOf(t.keyCode)&&(t.preventDefault(),t.stopPropagation())}),!0),h.ENV.TOUCH_ENABLED&&(u.addEventListener("touchstart",(function(t){var e=t.target.tagName.toLowerCase();-1===h.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(e)&&(t.preventDefault(),a.running||t.stopPropagation())}),!0),u.addEventListener("touchmove",(function(t){var e=t.target.tagName.toLowerCase();-1===h.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(e)&&(t.preventDefault(),a.running||t.stopPropagation())}),!0),u.addEventListener("touchend",(function(t){var e=t.target.tagName.toLowerCase();-1===h.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(e)&&(t.preventDefault(),a.running||t.stopPropagation())}),!0)),u.addEventListener("mousedown",(function(t){var e=t.target.tagName.toLowerCase();-1===h.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(e)&&(t.preventDefault(),a._mousedownID++,a.running||t.stopPropagation())}),!0),u.addEventListener("mousemove",(function(t){var e=t.target.tagName.toLowerCase();-1===h.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(e)&&(t.preventDefault(),a.running||t.stopPropagation())}),!0),u.addEventListener("mouseup",(function(t){var e=t.target.tagName.toLowerCase();-1===h.ENV.USE_DEFAULT_EVENT_TAGS.indexOf(e)&&(t.preventDefault(),a.running||t.stopPropagation())}),!0),a._touchEventTarget={},h.ENV.TOUCH_ENABLED&&(u.addEventListener("touchstart",(function(t){for(var e,n,i=h.Core.instance,r=new h.Event(h.Event.TOUCH_START),o=t.changedTouches,s=0,a=o.length;s<a;s++)e=o[s],r._initPosition(e.pageX,e.pageY),n=i.currentScene._determineEventTarget(r),i._touchEventTarget[e.identifier]=n,n.dispatchEvent(r)}),!1),u.addEventListener("touchmove",(function(t){for(var e,n,i=h.Core.instance,r=new h.Event(h.Event.TOUCH_MOVE),o=t.changedTouches,s=0,a=o.length;s<a;s++)e=o[s],(n=i._touchEventTarget[e.identifier])&&(r._initPosition(e.pageX,e.pageY),n.dispatchEvent(r))}),!1),u.addEventListener("touchend",(function(t){for(var e,n,i=h.Core.instance,r=new h.Event(h.Event.TOUCH_END),o=t.changedTouches,s=0,a=o.length;s<a;s++)e=o[s],(n=i._touchEventTarget[e.identifier])&&(r._initPosition(e.pageX,e.pageY),n.dispatchEvent(r),delete i._touchEventTarget[e.identifier])}),!1)),u.addEventListener("mousedown",(function(t){var e=h.Core.instance,n=new h.Event(h.Event.TOUCH_START);n._initPosition(t.pageX,t.pageY);var i=e.currentScene._determineEventTarget(n);e._touchEventTarget[e._mousedownID]=i,i.dispatchEvent(n)}),!1),u.addEventListener("mousemove",(function(t){var e=h.Core.instance,n=new h.Event(h.Event.TOUCH_MOVE);n._initPosition(t.pageX,t.pageY);var i=e._touchEventTarget[e._mousedownID];i&&i.dispatchEvent(n)}),!1),u.addEventListener("mouseup",(function(t){var e=h.Core.instance,n=new h.Event(h.Event.TOUCH_END);n._initPosition(t.pageX,t.pageY);var i=e._touchEventTarget[e._mousedownID];i&&i.dispatchEvent(n),delete e._touchEventTarget[e._mousedownID]}),!1))},width:{get:function(){return this._width},set:function(t){this._width=t,this._dispatchCoreResizeEvent()}},height:{get:function(){return this._height},set:function(t){this._height=t,this._dispatchCoreResizeEvent()}},scale:{get:function(){return this._scale},set:function(t){this._scale=t,this._dispatchCoreResizeEvent()}},_dispatchCoreResizeEvent:function(){var t=new h.Event("coreresize");t.width=this._width,t.height=this._height,t.scale=this._scale,this.dispatchEvent(t)},_oncoreresize:function(t){this._element.style.width=Math.floor(this._width*this._scale)+"px",this._element.style.height=Math.floor(this._height*this._scale)+"px";for(var e=0,n=this._scenes.length;e<n;e++)this._scenes[e].dispatchEvent(t)},preload:function(t){var e;if(!(t instanceof Array))if("object"===n(t)){for(var i in e=[],t)t.hasOwnProperty(i)&&e.push([t[i],i]);t=e}else t=Array.prototype.slice.call(arguments);return Array.prototype.push.apply(this._assets,t),this},load:function(t,e,n,i){var r;if("string"==typeof arguments[1])r=e,n=n||function(){},i=i||function(){};else{r=t;var o=n;n=arguments[1]||function(){},i=o||function(){}}var s=h.Core.findExt(t);return h.Deferred.next((function(){var e=new h.Deferred,o=function(t){e.call(t),n.call(this,t)},c=function(t){e.fail(t),i.call(this,t)};if(h.Core._loadFuncs[s])h.Core.instance.assets[r]=h.Core._loadFuncs[s](t,s,o,c);else{var u=new XMLHttpRequest;u.open("GET",t,!0),u.onreadystatechange=function(){if(4===u.readyState){if(200!==u.status&&0!==u.status){var e=new h.Event("error");e.message=u.status+": Cannot load an asset: "+t,c.call(h.Core.instance,e)}var n=u.getResponseHeader("Content-Type")||"";n.match(/^image/)?a.assets[r]=h.Surface.load(t,o,c):n.match(/^audio/)?a.assets[r]=h.Sound.load(t,n,o,c):(a.assets[r]=u.responseText,o.call(h.Core.instance,new h.Event("load")))}},u.send(null)}return e}))},start:function(e){if(this.addEventListener("load",(function t(){this.frame=0,this.removeEventListener("load",t)})),this.currentTime=t.getTime(),this.running=!0,this.ready=!0,!this._activated&&(this._activated=!0,"mobilesafari"===h.ENV.BROWSER&&h.ENV.USE_WEBAUDIO&&h.ENV.USE_TOUCH_TO_START_SCENE)){var n=new h.Deferred,i=this._createTouchToStartScene();return i.addEventListener(h.Event.TOUCH_START,(function t(){this.removeEventListener(h.Event.TOUCH_START,t);var e=new h.WebAudioSound;e.buffer=h.WebAudioSound.audioContext.createBuffer(1,1,48e3),e.play(),a.removeScene(i),a.start(n)}),!1),a.pushScene(i),n}this._requestNextFrame(0);var r=this._requestPreload().next((function(){h.Core.instance.loadingScene.dispatchEvent(new h.Event(h.Event.LOAD))}));return e&&r.next((function(t){e.call(t)})).error((function(t){e.fail(t)})),r},_requestPreload:function(){var t={},e=0,n=0,i=function(){var t=new h.Event("progress");t.loaded=++e,t.total=n,a.loadingScene.dispatchEvent(t)};return this._assets.reverse().forEach((function(e){var r,o;e instanceof Array?(r=e[0],o=e[1]):r=o=e,t[o]||(t[o]=this.load(r,o,i),n++)}),this),this.pushScene(this.loadingScene),h.Deferred.parallel(t)},_createTouchToStartScene:function(){var t=new h.Label("Touch to Start"),e=Math.round(a.width/10),n=new h.Scene;return t.color="#fff",t.font=e-1+"px bold Helvetica,Arial,sans-serif",t.textAlign="center",t.width=a.width,t.height=t._boundHeight,t.y=(a.height-t.height)/2,n.backgroundColor="#000",n.addChild(t),n},debug:function(){return this._debug=!0,this.start()},actualFps:{get:function(){return this._actualFps||this.fps}},_requestNextFrame:function(e){this.ready&&(this.fps>=60||e<=16?(this._calledTime=t.getTime(),t.requestAnimationFrame(this._callTick)):setTimeout((function(){var e=h.Core.instance;e._calledTime=t.getTime(),t.requestAnimationFrame(e._callTick)}),Math.max(0,e)))},_callTick:function(t){h.Core.instance._tick(t)},_tick:function(e){var n=new h.Event("enterframe"),i=t.getTime(),r=n.elapsed=i-this.currentTime;this.currentTime=i,this._actualFps=r>0?1e3/r:0;for(var o=this.currentScene.childNodes.slice(),s=Array.prototype.push;o.length;){var a=o.pop();a.age++,a.dispatchEvent(n),a.childNodes&&s.apply(o,a.childNodes)}this.currentScene.age++,this.currentScene.dispatchEvent(n),this.dispatchEvent(n),this.dispatchEvent(new h.Event("exitframe")),this.frame++,i=t.getTime(),this._requestNextFrame(1e3/this.fps-(i-this._calledTime))},getTime:function(){return t.getTime()},stop:function(){this.ready=!1,this.running=!1},pause:function(){this.ready=!1},resume:function(){this.ready||(this.currentTime=t.getTime(),this.ready=!0,this.running=!0,this._requestNextFrame(0))},pushScene:function(t){return this._element.appendChild(t._element),this.currentScene&&this.currentScene.dispatchEvent(new h.Event("exit")),this.currentScene=t,this.currentScene.dispatchEvent(new h.Event("enter")),this._scenes.push(t)},popScene:function(){return this.currentScene===this.rootScene?this.currentScene:(this._element.removeChild(this.currentScene._element),this.currentScene.dispatchEvent(new h.Event("exit")),this.currentScene=this._scenes[this._scenes.length-2],this.currentScene.dispatchEvent(new h.Event("enter")),this._scenes.pop())},replaceScene:function(t){return this.popScene(),this.pushScene(t)},removeScene:function(t){if(this.currentScene===t)return this.popScene();var e=this._scenes.indexOf(t);return-1!==e?(this._scenes.splice(e,1),this._element.removeChild(t._element),t):null},_buttonListener:function(t){this.currentScene.dispatchEvent(t)},keybind:function(t,e){return this.keyboardInputManager.keybind(t,e),this.addEventListener(e+"buttondown",this._buttonListener),this.addEventListener(e+"buttonup",this._buttonListener),this},keyunbind:function(t){var e=this._keybind[t];return this.keyboardInputManager.keyunbind(t),this.removeEventListener(e+"buttondown",this._buttonListener),this.removeEventListener(e+"buttonup",this._buttonListener),this},changeButtonState:function(t,e){this.keyboardInputManager.changeState(t,e)},getElapsedTime:function(){return this.frame/this.fps}}))._loadFuncs={},h.Core._loadFuncs.jpg=h.Core._loadFuncs.jpeg=h.Core._loadFuncs.gif=h.Core._loadFuncs.png=h.Core._loadFuncs.bmp=function(t,e,n,i){return h.Surface.load(t,n,i)},h.Core._loadFuncs.mp3=h.Core._loadFuncs.aac=h.Core._loadFuncs.m4a=h.Core._loadFuncs.wav=h.Core._loadFuncs.ogg=function(t,e,n,i){return h.Sound.load(t,"audio/"+e,n,i)},h.Core.findExt=function(t){var e=t.match(/\.\w+$/);return e&&e.length>0?e[0].slice(1).toLowerCase():0===t.indexOf("data:")?t.split(/[\/;]/)[1].toLowerCase():null},h.Core.instance=null,h.Game=h.Core,h.InputManager=h.Class.create(h.EventTarget,{initialize:function(t,e){h.EventTarget.call(this),this.broadcastTarget=[],this.valueStore=t,this.source=e||this,this._binds={},this._stateHandler=function(t){var e=t.source.identifier,n=this._binds[e];this.changeState(n,t.data)}.bind(this)},bind:function(t,e){t.addEventListener(h.Event.INPUT_STATE_CHANGED,this._stateHandler),this._binds[t.identifier]=e},unbind:function(t){t.removeEventListener(h.Event.INPUT_STATE_CHANGED,this._stateHandler),delete this._binds[t.identifier]},addBroadcastTarget:function(t){-1===this.broadcastTarget.indexOf(t)&&this.broadcastTarget.push(t)},removeBroadcastTarget:function(t){var e=this.broadcastTarget.indexOf(t);-1!==e&&this.broadcastTarget.splice(e,1)},broadcastEvent:function(t){for(var e=this.broadcastTarget,n=0,i=e.length;n<i;n++)e[n].dispatchEvent(t)},changeState:function(t,e){}}),h.InputSource=h.Class.create(h.EventTarget,{initialize:function(t){h.EventTarget.call(this),this.identifier=t},notifyStateChange:function(t){var e=new h.Event(h.Event.INPUT_STATE_CHANGED);e.data=t,e.source=this,this.dispatchEvent(e)}}),h.BinaryInputManager=h.Class.create(h.InputManager,{initialize:function(t,e,n,i){h.InputManager.call(this,t,i),this.activeInputsNum=0,this.activeEventNameSuffix=e,this.inactiveEventNameSuffix=n},bind:function(t,e){h.InputManager.prototype.bind.call(this,t,e),this.valueStore[e]=!1},unbind:function(t){var e=this._binds[t.identifier];h.InputManager.prototype.unbind.call(this,t),delete this.valueStore[e]},changeState:function(t,e){e?this._down(t):this._up(t)},_down:function(t){var e;this.valueStore[t]||(this.valueStore[t]=!0,(e=new h.Event(this.activeInputsNum++?"inputchange":"inputstart")).source=this.source,this.broadcastEvent(e));var n=new h.Event(t+this.activeEventNameSuffix);n.source=this.source,this.broadcastEvent(n)},_up:function(t){var e;this.valueStore[t]&&(this.valueStore[t]=!1,(e=new h.Event(--this.activeInputsNum?"inputchange":"inputend")).source=this.source,this.broadcastEvent(e));var n=new h.Event(t+this.inactiveEventNameSuffix);n.source=this.source,this.broadcastEvent(n)}}),h.BinaryInputSource=h.Class.create(h.InputSource,{initialize:function(t){h.InputSource.call(this,t)}}),h.KeyboardInputManager=h.Class.create(h.BinaryInputManager,{initialize:function(t,e){h.BinaryInputManager.call(this,e,"buttondown","buttonup"),this._attachDOMEvent(t,"keydown",!0),this._attachDOMEvent(t,"keyup",!1)},keybind:function(t,e){this.bind(h.KeyboardInputSource.getByKeyCode(""+t),e)},keyunbind:function(t){this.unbind(h.KeyboardInputSource.getByKeyCode(""+t))},_attachDOMEvent:function(t,e,n){t.addEventListener(e,(function(t){var e=h.Core.instance;if(e&&e.running){var i=t.keyCode,r=h.KeyboardInputSource._instances[i];r&&r.notifyStateChange(n)}}),!0)}}),(h.KeyboardInputSource=h.Class.create(h.BinaryInputSource,{initialize:function(t){h.BinaryInputSource.call(this,t)}}))._instances={},h.KeyboardInputSource.getByKeyCode=function(t){return this._instances[t]||(this._instances[t]=new h.KeyboardInputSource(t)),this._instances[t]},h.Node=h.Class.create(h.EventTarget,{initialize:function(){h.EventTarget.call(this),this._dirty=!1,this._matrix=[1,0,0,1,0,0],this._x=0,this._y=0,this._offsetX=0,this._offsetY=0,this.age=0,this.parentNode=null,this.scene=null,this.addEventListener("touchstart",(function(t){this.parentNode&&this.parentNode.dispatchEvent(t)})),this.addEventListener("touchmove",(function(t){this.parentNode&&this.parentNode.dispatchEvent(t)})),this.addEventListener("touchend",(function(t){this.parentNode&&this.parentNode.dispatchEvent(t)})),h.ENV.USE_ANIMATION&&(this.tl=new h.Timeline(this))},moveTo:function(t,e){this.x=t,this.y=e},moveBy:function(t,e){this.x+=t,this.y+=e},x:{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this._dirty=!0)}},y:{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this._dirty=!0)}},_updateCoordinate:function(){var t=this,e=[t],n=t.parentNode;for(this.scene;n&&t._dirty;)e.unshift(n),n=(t=t.parentNode).parentNode;var i,r,o,s=h.Matrix.instance,a=s.stack,c=[];a.push(e[0]._matrix);for(var u=1,l=e.length;u<l;u++){t=e[u],i=[],s.makeTransformMatrix(t,c),s.multiply(a[a.length-1],c,i),t._matrix=i,a.push(i);var f=[r="number"==typeof t._originX?t._originX:t._width/2||0,o="number"==typeof t._originY?t._originY:t._height/2||0];s.multiplyVec(i,f,f),t._offsetX=f[0]-r,t._offsetY=f[1]-o,t._dirty=!1}s.reset()},remove:function(){if(this.parentNode&&this.parentNode.removeChild(this),this.childNodes)for(var t=this.childNodes.slice(),e=t.length-1;e>=0;e--)t[e].remove();this.clearEventListener()}});var c=function(t,e){for(var n,i=[],r=0,o=t.collection.length;r<o;r++)n=t.collection[r],e._intersectOne(n)&&i.push(n);return i},u=function(t,e){for(var n,i=[],r=0,o=t.collection.length;r<o;r++)n=t.collection[r],e._intersectStrictOne(n)&&i.push(n);return i},l=function(t){return t instanceof h.Entity?c(this,t):!("function"!=typeof t||!t.collection)&&function(t,e){for(var n,i,r=[],o=0,s=t.collection.length;o<s;o++){n=t.collection[o];for(var a=0,h=e.collection.length;a<h;a++)i=e.collection[a],n._intersectOne(i)&&r.push([n,i])}return r}(this,t)},f=function(t){return t instanceof h.Entity?u(this,t):!("function"!=typeof t||!t.collection)&&function(t,e){for(var n,i,r=[],o=0,s=t.collection.length;o<s;o++){n=t.collection[o];for(var a=0,h=e.collection.length;a<h;a++)i=e.collection[a],n._intersectStrictOne(i)&&r.push([n,i])}return r}(this,t)},d=h.Node.prototype.clearEventListener;h.Entity=h.Class.create(h.Node,{initialize:function(){var t=h.Core.instance;h.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._touchEnabled=!0,this._clipping=!1,this._originX=null,this._originY=null,this._width=0,this._height=0,this._backgroundColor=null,this._debugColor="#0000ff",this._opacity=1,this._visible=!0,this._buttonMode=null,this._style={},this.__styleStatus={},this._isContainedInCollection=!1,this.compositeOperation=null,this.buttonMode=null,this.buttonPressed=!1,this.addEventListener("touchstart",(function(){this.buttonMode&&(this.buttonPressed=!0,this.dispatchEvent(new h.Event(this.buttonMode+"buttondown")),t.changeButtonState(this.buttonMode,!0))})),this.addEventListener("touchend",(function(){this.buttonMode&&(this.buttonPressed=!1,this.dispatchEvent(new h.Event(this.buttonMode+"buttonup")),t.changeButtonState(this.buttonMode,!1))})),this.enableCollection()},width:{get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._dirty=!0)}},height:{get:function(){return this._height},set:function(t){this._height!==t&&(this._height=t,this._dirty=!0)}},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t}},debugColor:{get:function(){return this._debugColor},set:function(t){this._debugColor=t}},opacity:{get:function(){return this._opacity},set:function(t){this._opacity=parseFloat(t)}},visible:{get:function(){return this._visible},set:function(t){this._visible=t}},touchEnabled:{get:function(){return this._touchEnabled},set:function(t){this._touchEnabled=t,this._style.pointerEvents=t?"all":"none"}},intersect:function(t){return t instanceof h.Entity?this._intersectOne(t):!("function"!=typeof t||!t.collection)&&c(t,this)},_intersectOne:function(t){return this._dirty&&this._updateCoordinate(),t._dirty&&t._updateCoordinate(),this._offsetX<t._offsetX+t.width&&t._offsetX<this._offsetX+this.width&&this._offsetY<t._offsetY+t.height&&t._offsetY<this._offsetY+this.height},intersectStrict:function(t){return t instanceof h.Entity?this._intersectStrictOne(t):!("function"!=typeof t||!t.collection)&&u(t,this)},_intersectStrictOne:function(t){this._dirty&&this._updateCoordinate(),t._dirty&&t._updateCoordinate();var e,n,i,r,o,s,a,h,c,u,l,f,d,m,p,_,v,g,y,E,b,w,S,C=this.getOrientedBoundingRect(),x=t.getOrientedBoundingRect(),T=C.leftTop,O=C.rightTop,N=C.leftBottom,M=C.rightBottom,A=x.leftTop,R=x.rightTop,D=x.leftBottom,L=x.rightBottom,I=T[0],P=T[1],k=O[0],B=O[1],U=N[0],j=N[1],F=M[0],X=M[1],Y=A[0],G=A[1],H=R[0],z=R[1],V=D[0],q=D[1],W=L[0],K=L[1],J=[k-I,B-P],Q=[F-k,X-B],Z=[U-F,j-X],$=[I-U,P-j],tt=[H-Y,z-G],et=[W-H,K-z],nt=[V-W,q-K],it=[Y-V,G-q],rt=I+k+U+F>>2,ot=P+B+j+X>>2,st=Y+H+V+W>>2,at=G+z+q+K>>2;if(J[0]*(at-P)-J[1]*(st-I)>0&&Q[0]*(at-B)-Q[1]*(st-k)>0&&Z[0]*(at-X)-Z[1]*(st-F)>0&&$[0]*(at-j)-$[1]*(st-U)>0)return!0;if(tt[0]*(ot-G)-tt[1]*(rt-Y)>0&&et[0]*(ot-z)-et[1]*(rt-H)>0&&nt[0]*(ot-K)-nt[1]*(rt-W)>0&&it[0]*(ot-q)-it[1]*(rt-V)>0)return!0;for(i=[T,O,M,N],r=[A,R,L,D],o=[J,Q,Z,$],s=[tt,et,nt,it],e=0;e<4;e++)for(l=(a=i[e])[0],f=a[1],p=(c=o[e])[0],_=c[1],n=0;n<4;n++)if(d=(h=r[n])[0],m=h[1],v=(u=s[n])[0],0!==(b=p*(g=u[1])-_*v)&&(S=((y=d-l)*g-(E=m-f)*v)/b,0<(w=(y*_-E*p)/b)&&w<1&&0<S&&S<1))return!0;return!1},within:function(t,e){var n;return this._dirty&&this._updateCoordinate(),t._dirty&&t._updateCoordinate(),null==e&&(e=(this.width+this.height+t.width+t.height)/4),(n=this._offsetX-t._offsetX+(this.width-t.width)/2)*n+(n=this._offsetY-t._offsetY+(this.height-t.height)/2)*n<e*e},scale:function(t,e){this._scaleX*=t,this._scaleY*=null!=e?e:t,this._dirty=!0},rotate:function(t){this.rotation+=t},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._dirty=!0)}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._dirty=!0)}},rotation:{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._dirty=!0)}},originX:{get:function(){return this._originX},set:function(t){this._originX!==t&&(this._originX=t,this._dirty=!0)}},originY:{get:function(){return this._originY},set:function(t){this._originY!==t&&(this._originY=t,this._dirty=!0)}},enableCollection:function(){this.addEventListener("addedtoscene",this._addSelfToCollection),this.addEventListener("removedfromscene",this._removeSelfFromCollection),this.scene&&this._addSelfToCollection()},disableCollection:function(){this.removeEventListener("addedtoscene",this._addSelfToCollection),this.removeEventListener("removedfromscene",this._removeSelfFromCollection),this.scene&&this._removeSelfFromCollection()},clearEventListener:function(){d.apply(this,arguments),this.scene&&this._removeSelfFromCollection()},_addSelfToCollection:function(){this._isContainedInCollection||(this.getConstructor()._collectionTarget.forEach((function(t){t.collection.push(this)}),this),this._isContainedInCollection=!0)},_removeSelfFromCollection:function(){this._isContainedInCollection&&(this.getConstructor()._collectionTarget.forEach((function(t){var e=t.collection.indexOf(this);-1!==e&&t.collection.splice(e,1)}),this),this._isContainedInCollection=!1)},getBoundingRect:function(){var t=this.width||0,e=this.height||0,n=this._matrix,i=n[0]*t,r=n[1]*t,o=n[2]*e,s=n[3]*e,a=n[4],h=n[5],c=[a,i+a,o+a,i+o+a].sort((function(t,e){return t-e})),u=[h,r+h,s+h,r+s+h].sort((function(t,e){return t-e}));return{left:c[0],top:u[0],width:c[3]-c[0],height:u[3]-u[0]}},getOrientedBoundingRect:function(){var t=this.width||0,e=this.height||0,n=this._matrix,i=n[0]*t,r=n[1]*t,o=n[2]*e,s=n[3]*e,a=n[4],h=n[5];return{leftTop:[a,h],rightTop:[i+a,r+h],leftBottom:[o+a,s+h],rightBottom:[i+o+a,r+s+h]}},getConstructor:function(){return Object.getPrototypeOf(this).constructor}});var m=function(t){if(!t._collective){var e=h.Class.getInheritanceTree(t),n=e.indexOf(h.Entity);t._collectionTarget=-1!==n?e.splice(0,n+1):[],t.intersect=l,t.intersectStrict=f,t.collection=[],t._collective=!0}};m(h.Entity),h.Entity._inherited=function(t){m(t)},h.Sprite=h.Class.create(h.Entity,{initialize:function(t,e){h.Entity.call(this),this.width=t,this.height=e,this._image=null,this._debugColor="#ff0000",this._frameLeft=0,this._frameTop=0,this._frame=0,this._frameSequence=null},image:{get:function(){return this._image},set:function(t){if(void 0===t)throw new Error("Assigned value on Sprite.image is undefined. Please double-check image path, and check if the image you want to use is preload before use.");t!==this._image&&(this._image=t,this._computeFramePosition())}},frame:{get:function(){return this._frame},set:function(t){null==this._frameSequence&&this._frame===t||this._deepCompareToPreviousFrame(t)||(t instanceof Array?this._frameSequence=t:(this._frameSequence=null,this._frame=t,this._computeFramePosition()))}},_frameSequence:{get:function(){return this.__frameSequence},set:function(t){t&&!this.__frameSequence?this.addEventListener(h.Event.ENTER_FRAME,this._rotateFrameSequence):!t&&this.__frameSequence&&this.removeEventListener(h.Event.ENTER_FRAME,this._rotateFrameSequence),t?(this.__frameSequence=t.slice(),this._originalFrameSequence=t.slice(),this._rotateFrameSequence()):(this.__frameSequence=null,this._originalFrameSequence=null)}},_deepCompareToPreviousFrame:function(t){if(t===this._originalFrameSequence)return!0;if(null==t||null==this._originalFrameSequence)return!1;if(!(t instanceof Array))return!1;if(t.length!==this._originalFrameSequence.length)return!1;for(var e=0;e<t.length;++e)if(t[e]!==this._originalFrameSequence[e])return!1;return!0},_computeFramePosition:function(){var t,e=this._image;null!=e&&(t=e.width/this._width|0,this._frameLeft=(this._frame%t|0)*this._width,this._frameTop=(this._frame/t|0)*this._height%e.height)},_rotateFrameSequence:function(){var t=this._frameSequence;if(t&&0!==t.length){var e=t.shift();null===e?(this._frameSequence=null,this.dispatchEvent(new h.Event(h.Event.ANIMATION_END))):(this._frame=e,this._computeFramePosition(),t.push(e))}},width:{get:function(){return this._width},set:function(t){this._width=t,this._computeFramePosition(),this._dirty=!0}},height:{get:function(){return this._height},set:function(t){this._height=t,this._computeFramePosition(),this._dirty=!0}},cvsRender:function(t){var e,n,i,r,o,s,a,c=this._image,u=this._width,l=this._height;c&&0!==u&&0!==l&&(e=c.width,n=c.height,e<u||n<l?(t.fillStyle=h.Surface._getPattern(c),t.fillRect(0,0,u,l)):(i=c._element,r=this._frameLeft,o=Math.min(this._frameTop,n-l),s=Math.max(.01,Math.min(e-r,u)),a=Math.max(.01,Math.min(n-o,l)),t.drawImage(i,r,o,s,a,0,0,u,l)))},domRender:(h.ENV.VENDOR_PREFIX,function(t){this._image&&(this._image._css?(this._style["background-image"]=this._image._css,this._style["background-position"]=-this._frameLeft+"px "+-this._frameTop+"px"):this._image._element)})}),h.Label=h.Class.create(h.Entity,{initialize:function(t){h.Entity.call(this),this.text=t||"",this.width=300,this.font="14px serif",this.textAlign="left",this._debugColor="#ff0000"},width:{get:function(){return this._width},set:function(t){this._width=t,this._dirty=!0,this.updateBoundArea()}},text:{get:function(){return this._text},set:function(t){if(t=""+t,this._text!==t){this._text=t,t=t.replace(/<br ?\/?>/gi,"<br/>"),this._splitText=t.split("<br/>"),this.updateBoundArea();for(var e=0,n=this._splitText.length;e<n;e++){t=this._splitText[e];var i=this.getMetrics(t);this._splitText[e]={},this._splitText[e].text=t,this._splitText[e].height=i.height,this._splitText[e].width=i.width}}}},textAlign:{get:function(){return this._style["text-align"]},set:function(t){this._style["text-align"]=t,this.updateBoundArea()}},font:{get:function(){return this._style.font},set:function(t){this._style.font=t,this.updateBoundArea()}},color:{get:function(){return this._style.color},set:function(t){this._style.color=t}},cvsRender:function(t){var e,n,i,r,o,s,a,h,c=0,u=this.width;if(this._splitText){t.textBaseline="top",t.font=this.font,t.fillStyle=this.color||"#000000",n=u/t.measureText(" ").width;for(var l=0,f=this._splitText.length;l<f;l++){for(r=(i=this._splitText[l]).text,o=0;r.length>o+n||t.measureText(r.slice(o,o+n)).width>u;){for(s="",a=n,h=0;a>0;)t.measureText(s).width<u?(h+=a,s=r.slice(o,o+h)):(h-=a,s=r.slice(o,o+h)),a=a/2|0;t.fillText(s,0,c),c+=i.height-1,o+=h}s=r.slice(o,o+r.length),e="right"===this.textAlign?u-t.measureText(s).width:"center"===this.textAlign?(u-t.measureText(s).width)/2:0,t.fillText(s,e,c),c+=i.height-1}}},domRender:function(t){t.innerHTML!==this._text&&(t.innerHTML=this._text)},detectRender:function(t){t.fillRect(this._boundOffset,0,this._boundWidth,this._boundHeight)},updateBoundArea:function(){var t=this.getMetrics();this._boundWidth=t.width,this._boundHeight=t.height,"right"===this.textAlign?this._boundOffset=this.width-this._boundWidth:"center"===this.textAlign?this._boundOffset=(this.width-this._boundWidth)/2:this._boundOffset=0},getMetrics:function(t){var e,n={};if(document.body){for(var i in e=document.createElement("div"),this._style)"width"!==i&&"height"!==i&&(e.style[i]=this._style[i]);t=t||this._text,e.innerHTML=t.replace(/ /g,"&nbsp;"),e.style.whiteSpace="noWrap",e.style.lineHeight=1,document.body.appendChild(e);var r=getComputedStyle(e);n.height=parseInt(r.height,10)+1,e.style.position="absolute",n.width=parseInt(r.width,10)+1,document.body.removeChild(e)}else n.width=this.width,n.height=this.height;return n}}),h.Map=h.Class.create(h.Entity,{initialize:function(t,e){var n=h.Core.instance;h.Entity.call(this);var i=new h.Surface(n.width,n.height);this._surface=i;var r=i._element;r.style.position="absolute",h.ENV.RETINA_DISPLAY&&2===n.scale?(r.width=2*n.width,r.height=2*n.height,this._style.webkitTransformOrigin="0 0",this._style.webkitTransform="scale(0.5)"):(r.width=n.width,r.height=n.height),this._context=r.getContext("2d"),this._tileWidth=t||0,this._tileHeight=e||0,this._image=null,this._data=[[[]]],this._dirty=!1,this._tight=!1,this.touchEnabled=!1,this.collisionData=null,this._listeners.render=null,this.addEventListener("render",(function(){this._dirty&&(this._previousOffsetX=this._previousOffsetY=null)}))},loadData:function(t){this._data=Array.prototype.slice.apply(arguments),this._dirty=!0,this._tight=!1;for(var e=0,n=this._data.length;e<n;e++){for(var i=0,r=0,o=(t=this._data[e]).length;r<o;r++)for(var s=0,a=t[r].length;s<a;s++)t[r][s]>=0&&i++;if(i/(t.length*t[0].length)>.2){this._tight=!0;break}}},checkTile:function(t,e){if(t<0||this.width<=t||e<0||this.height<=e)return!1;var n=this._image.width,i=this._image.height;return t=t/(this._tileWidth||n)|0,e=e/(this._tileHeight||i)|0,this._data[0][e][t]},hitTest:function(t,e){if(t<0||this.width<=t||e<0||this.height<=e)return!1;var n=this._image.width,i=this._image.height,r=this._tileWidth||n,o=this._tileHeight||i;if(t=t/r|0,e=e/o|0,null!=this.collisionData)return this.collisionData[e]&&!!this.collisionData[e][t];for(var s=0,a=this._data.length;s<a;s++){var h,c=this._data[s];if(null!=c[e]&&null!=(h=c[e][t])&&0<=h&&h<(n/r|0)*(i/o|0))return!0}return!1},image:{get:function(){return this._image},set:function(t){var e=h.Core.instance;if(this._image=t,h.ENV.RETINA_DISPLAY&&2===e.scale){for(var n=new h.Surface(2*t.width,2*t.height),i=this._tileWidth||t.width,r=this._tileHeight||t.height,o=t.width/i|0,s=t.height/r|0,a=0;a<s;a++)for(var c=0;c<o;c++)n.draw(t,c*i,a*r,i,r,c*i*2,a*r*2,2*i,2*r);this._doubledImage=n}this._dirty=!0}},tileWidth:{get:function(){return this._tileWidth},set:function(t){this._tileWidth!==t&&(this._tileWidth=t,this._dirty=!0)}},tileHeight:{get:function(){return this._tileHeight},set:function(t){this._tileHeight!==t&&(this._tileHeight=t,this._dirty=!0)}},width:{get:function(){return this._tileWidth*this._data[0][0].length}},height:{get:function(){return this._tileHeight*this._data[0].length}},redraw:function(t,e,n,i){if(null!=this._image){var r,o,s,a,h;this._doubledImage?(r=this._doubledImage,o=2*this._tileWidth,s=2*this._tileHeight,a=2*-this._offsetX,h=2*-this._offsetY,t*=2,e*=2,n*=2,i*=2):(r=this._image,o=this._tileWidth,s=this._tileHeight,a=-this._offsetX,h=-this._offsetY);var c=r.width/o|0,u=r.height/s|0,l=Math.max((t+a)/o|0,0),f=Math.max((e+h)/s|0,0),d=Math.ceil((t+a+n)/o),m=Math.ceil((e+h+i)/s),p=r._element,_=this._context;_.canvas;_.clearRect(t,e,n,i);for(var v=0,g=this._data.length;v<g;v++){var y=this._data[v],E=Math.min(d,y[0].length),b=Math.min(m,y.length);for(e=f;e<b;e++)for(t=l;t<E;t++){var w=y[e][t];if(0<=w&&w<c*u){var S=w%c*o,C=(w/c|0)*s;_.drawImage(p,S,C,o,s,t*o-a,e*s-h,o,s)}}}}},updateBuffer:function(){if(void 0===this._visible||this._visible){var t=h.Core.instance;if(this._dirty||null==this._previousOffsetX)this.redraw(0,0,t.width,t.height);else if(this._offsetX!==this._previousOffsetX||this._offsetY!==this._previousOffsetY)if(this._tight){var e=-this._offsetX,n=-this._offsetY,i=-this._previousOffsetX,r=-this._previousOffsetY,o=e-i+t.width,s=i-e+t.width,a=n-r+t.height,c=r-n+t.height;if(o>this._tileWidth&&s>this._tileWidth&&a>this._tileHeight&&c>this._tileHeight){var u,l,f,d,m,p;o<s?(u=0,f=i-e,m=o):(u=e-i,f=0,m=s),a<c?(l=0,d=r-n,p=a):(l=n-r,d=0,p=c),null==t._buffer&&(t._buffer=document.createElement("canvas"),t._buffer.width=this._context.canvas.width,t._buffer.height=this._context.canvas.height);var _=t._buffer.getContext("2d");this._doubledImage?(_.clearRect(0,0,2*m,2*p),_.drawImage(this._context.canvas,2*u,2*l,2*m,2*p,0,0,2*m,2*p),(_=this._context).clearRect(2*f,2*d,2*m,2*p),_.drawImage(t._buffer,0,0,2*m,2*p,2*f,2*d,2*m,2*p)):(_.clearRect(0,0,m,p),_.drawImage(this._context.canvas,u,l,m,p,0,0,m,p),(_=this._context).clearRect(f,d,m,p),_.drawImage(t._buffer,0,0,m,p,f,d,m,p)),0===f?this.redraw(m,0,t.width-m,t.height):this.redraw(0,0,t.width-m,t.height),0===d?this.redraw(0,p,t.width,t.height-p):this.redraw(0,0,t.width,t.height-p)}else this.redraw(0,0,t.width,t.height)}else this.redraw(0,0,t.width,t.height);this._previousOffsetX=this._offsetX,this._previousOffsetY=this._offsetY}},cvsRender:function(t){if(0!==this.width&&0!==this.height){var e=h.Core.instance;this.updateBuffer(),t.save(),t.setTransform(1,0,0,1,0,0);var n=this._context.canvas;t.drawImage(n,0,0,e.width,e.height),t.restore()}},domRender:function(t){this._image&&(this.updateBuffer(),this._style["background-image"]=this._surface._css,this._style[h.ENV.VENDOR_PREFIX+"Transform"]="matrix(1, 0, 0, 1, 0, 0)")}}),h.Group=h.Class.create(h.Node,{initialize:function(){this.childNodes=[],h.Node.call(this),this._rotation=0,this._scaleX=1,this._scaleY=1,this._originX=null,this._originY=null,this.__dirty=!1,[h.Event.ADDED_TO_SCENE,h.Event.REMOVED_FROM_SCENE].forEach((function(t){this.addEventListener(t,(function(t){this.childNodes.forEach((function(e){e.scene=this.scene,e.dispatchEvent(t)}),this)}))}),this)},addChild:function(t){t.parentNode&&t.parentNode.removeChild(t),this.childNodes.push(t),t.parentNode=this;var e=new h.Event("childadded");if(e.node=t,e.next=null,this.dispatchEvent(e),t.dispatchEvent(new h.Event("added")),this.scene){t.scene=this.scene;var n=new h.Event("addedtoscene");t.dispatchEvent(n)}},insertBefore:function(t,e){t.parentNode&&t.parentNode.removeChild(t);var n=this.childNodes.indexOf(e);if(-1!==n){this.childNodes.splice(n,0,t),t.parentNode=this;var i=new h.Event("childadded");if(i.node=t,i.next=e,this.dispatchEvent(i),t.dispatchEvent(new h.Event("added")),this.scene){t.scene=this.scene;var r=new h.Event("addedtoscene");t.dispatchEvent(r)}}else this.addChild(t)},removeChild:function(t){var e;if(-1!==(e=this.childNodes.indexOf(t))){this.childNodes.splice(e,1),t.parentNode=null;var n=new h.Event("childremoved");if(n.node=t,this.dispatchEvent(n),t.dispatchEvent(new h.Event("removed")),this.scene){t.scene=null;var i=new h.Event("removedfromscene");t.dispatchEvent(i)}}},firstChild:{get:function(){return this.childNodes[0]}},lastChild:{get:function(){return this.childNodes[this.childNodes.length-1]}},rotation:{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this._dirty=!0)}},scaleX:{get:function(){return this._scaleX},set:function(t){this._scaleX!==t&&(this._scaleX=t,this._dirty=!0)}},scaleY:{get:function(){return this._scaleY},set:function(t){this._scaleY!==t&&(this._scaleY=t,this._dirty=!0)}},originX:{get:function(){return this._originX},set:function(t){this._originX!==t&&(this._originX=t,this._dirty=!0)}},originY:{get:function(){return this._originY},set:function(t){this._originY!==t&&(this._originY=t,this._dirty=!0)}},_dirty:{get:function(){return this.__dirty},set:function(t){if(t=!!t,this.__dirty=t,t)for(var e=0,n=this.childNodes.length;e<n;e++)this.childNodes[e]._dirty=!0}}}),(h.Matrix=h.Class.create({initialize:function(){this.reset()},reset:function(){this.stack=[],this.stack.push([1,0,0,1,0,0])},makeTransformMatrix:function(t,e){var n=t._x,i=t._y,r=t.width||0,o=t.height||0,s=t._rotation||0,a="number"==typeof t._scaleX?t._scaleX:1,h="number"==typeof t._scaleY?t._scaleY:1,c=s*Math.PI/180,u=Math.cos(c),l=Math.sin(c),f="number"==typeof t._originX?t._originX:r/2,d="number"==typeof t._originY?t._originY:o/2,m=a*u,p=a*l,_=h*l,v=h*u;e[0]=m,e[1]=p,e[2]=-_,e[3]=v,e[4]=-m*f+_*d+n+f,e[5]=-p*f-v*d+i+d},multiply:function(t,e,n){var i=t[0],r=t[2],o=t[4],s=t[1],a=t[3],h=t[5],c=e[0],u=e[2],l=e[4],f=e[1],d=e[3],m=e[5];n[0]=i*c+r*f,n[1]=s*c+a*f,n[2]=i*u+r*d,n[3]=s*u+a*d,n[4]=i*l+r*m+o,n[5]=s*l+a*m+h},multiplyVec:function(t,e,n){var i=e[0],r=e[1],o=t[0],s=t[2],a=t[4],h=t[1],c=t[3],u=t[5];n[0]=o*i+s*r+a,n[1]=h*i+c*r+u}})).instance=new h.Matrix,h.DetectColorManager=h.Class.create({initialize:function(t,e){this.reference=[],this.colorResolution=t||16,this.max=e||1,this.capacity=Math.pow(this.colorResolution,3);for(var n=1,i=this.capacity;n<i;n++)this.reference[n]=null},attachDetectColor:function(t){var e=this.reference.indexOf(null);return-1===e&&(e=1),this.reference[e]=t,this._getColor(e)},detachDetectColor:function(t){var e=this.reference.indexOf(t);-1!==e&&(this.reference[e]=null)},_getColor:function(t){var e=this.colorResolution,n=e/this.max;return[parseInt(t/e/e%e,10)/n,parseInt(t/e%e,10)/n,parseInt(t%e,10)/n,1]},_decodeDetectColor:function(t,e){e=e||0;var n=this.colorResolution;return~~(t[e]*n*n*n/256)+~~(t[e+1]*n*n/256)+~~(t[e+2]*n/256)},getSpriteByColor:function(t){return this.reference[this._decodeDetectColor(t)]},getSpriteByColors:function(t){var e,n,i,r,o=0,s={};for(e=0,n=t.length;e<n;e+=4)s[i=this._decodeDetectColor(t,e)]=(s[i]||0)+1;for(i in s)s[i]>o&&(o=s[i],r=i);return this.reference[r]}}),h.DomManager=h.Class.create({initialize:function(t,e){var n=h.Core.instance;this.layer=null,this.targetNode=t,"string"==typeof e?this.element=document.createElement(e):e instanceof HTMLElement&&(this.element=e),this.style=this.element.style,this.style.position="absolute",this.style[h.ENV.VENDOR_PREFIX+"TransformOrigin"]="0px 0px",n._debug&&(this.style.border="1px solid blue",this.style.margin="-1px");var i=this;this._setDomTarget=function(){i.layer._touchEventTarget=i.targetNode},this._attachEvent()},getDomElement:function(){return this.element},getDomElementAsNext:function(){return this.element},getNextManager:function(t){var e=this.targetNode.parentNode.childNodes.indexOf(t.targetNode);return e!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[e+1]._domManager:null},addManager:function(t,e){var n;e&&(n=e.getDomElementAsNext());var i=t.getDomElement();i instanceof Array?i.forEach((function(t){n?this.element.insertBefore(t,n):this.element.appendChild(t)}),this):n?this.element.insertBefore(i,n):this.element.appendChild(i),this.setLayer(this.layer)},removeManager:function(t){t instanceof h.DomlessManager?t._domRef.forEach((function(t){this.element.removeChild(t)}),this):this.element.removeChild(t.element),this.setLayer(this.layer)},setLayer:function(t){this.layer=t;var e,n=this.targetNode;if(n.childNodes)for(var i=0,r=n.childNodes.length;i<r;i++)(e=n.childNodes[i]._domManager)&&e.setLayer(t)},render:function(t){var e=this.targetNode,n=h.Matrix.instance,i=n.stack,r=[];n.makeTransformMatrix(e,r),n.multiply(i[i.length-1],r,r),n.multiply(t,r,t),e._matrix=t;var o="number"==typeof e._originX?e._originX:e.width/2||0,s="number"==typeof e._originY?e._originY:e.height/2||0,a=[o,s];n.multiplyVec(r,a,a),e._offsetX=a[0]-o,e._offsetY=a[1]-s,!e.parentNode||e.parentNode instanceof h.Group||(e._offsetX+=e.parentNode._offsetX,e._offsetY+=e.parentNode._offsetY),e._dirty&&(this.style[h.ENV.VENDOR_PREFIX+"Transform"]="matrix("+r[0].toFixed(10)+","+r[1].toFixed(10)+","+r[2].toFixed(10)+","+r[3].toFixed(10)+","+r[4].toFixed(10)+","+r[5].toFixed(10)+")"),this.domRender()},domRender:function(){var t,e=this.targetNode;for(var n in e._style||(e._style={}),e.__styleStatus||(e.__styleStatus={}),null!==e.width&&(e._style.width=e.width+"px"),null!==e.height&&(e._style.height=e.height+"px"),e._style.opacity=e._opacity,e._style["background-color"]=e._backgroundColor,void 0!==e._visible&&(e._style.display=e._visible?"block":"none"),"function"==typeof e.domRender&&e.domRender(this.element),e._style)t=e._style[n],e.__styleStatus[n]!==t&&null!=t&&(this.style.setProperty(n,""+t),e.__styleStatus[n]=t)},_attachEvent:function(){h.ENV.TOUCH_ENABLED&&this.element.addEventListener("touchstart",this._setDomTarget,!0),this.element.addEventListener("mousedown",this._setDomTarget,!0)},_detachEvent:function(){h.ENV.TOUCH_ENABLED&&this.element.removeEventListener("touchstart",this._setDomTarget,!0),this.element.removeEventListener("mousedown",this._setDomTarget,!0)},remove:function(){this._detachEvent(),this.element=this.style=this.targetNode=null}}),h.DomlessManager=h.Class.create({initialize:function(t){this._domRef=[],this.targetNode=t},_register:function(t,e){var n=this._domRef.indexOf(e);t instanceof Array?-1===n?Array.prototype.push.apply(this._domRef,t):Array.prototype.splice.apply(this._domRef,[n,0].concat(t)):-1===n?this._domRef.push(t):this._domRef.splice(n,0,t)},getNextManager:function(t){var e=this.targetNode.parentNode.childNodes.indexOf(t.targetNode);return e!==this.targetNode.parentNode.childNodes.length-1?this.targetNode.parentNode.childNodes[e+1]._domManager:null},getDomElement:function(){var t=[];return this.targetNode.childNodes.forEach((function(e){t=t.concat(e._domManager.getDomElement())})),t},getDomElementAsNext:function(){if(this._domRef.length)return this._domRef[0];var t=this.getNextManager(this);return t?t.element:null},addManager:function(t,e){var n=this.targetNode.parentNode;n&&(null===e&&(e=this.getNextManager(this)),n instanceof h.Scene?n._layers.Dom._domManager.addManager(t,e):n._domManager.addManager(t,e));var i=e?e.getDomElementAsNext():null;this._register(t.getDomElement(),i),this.setLayer(this.layer)},removeManager:function(t){var e,n=this._domRef.indexOf(t.element);-1!==n&&((e=this._domRef[n]).parentNode.removeChild(e),this._domRef.splice(n,1)),this.setLayer(this.layer)},setLayer:function(t){this.layer=t;var e,n=this.targetNode;if(n.childNodes)for(var i=0,r=n.childNodes.length;i<r;i++)(e=n.childNodes[i]._domManager)&&e.setLayer(t)},render:function(t){var e=h.Matrix.instance,n=e.stack,i=this.targetNode,r=[];e.makeTransformMatrix(i,r),e.multiply(n[n.length-1],r,r),e.multiply(t,r,t),i._matrix=t;var o="number"==typeof i._originX?i._originX:i.width/2||0,s="number"==typeof i._originY?i._originY:i.height/2||0,a=[o,s];e.multiplyVec(r,a,a),i._offsetX=a[0]-o,i._offsetY=a[1]-s,n.push(r)},remove:function(){this._domRef=[],this.targetNode=null}}),(h.DomLayer=h.Class.create(h.Group,{initialize:function(){var t=h.Core.instance;h.Group.call(this),this._touchEventTarget=null,this._element=document.createElement("div"),this._element.style.position="absolute",this._domManager=new h.DomManager(this,this._element),this._domManager.layer=this,this.width=t.width,this.height=t.height,[h.Event.TOUCH_START,h.Event.TOUCH_MOVE,h.Event.TOUCH_END].forEach((function(t){this.addEventListener(t,(function(t){this._scene&&this._scene.dispatchEvent(t)}))}),this);var e=function t(e){var i=e.node,r=e.next,o=e.target,s=r?r._domManager:null;h.DomLayer._attachDomManager(i,t,n),o._domManager.addManager(i._domManager,s);var a=new h.Event(h.Event.RENDER);i._dirty=!0,o._domManager.layer._rendering(i,a)},n=function t(n){var i=n.node;n.target._domManager.removeManager(i._domManager),h.DomLayer._detachDomManager(i,e,t)};this.addEventListener("childremoved",n),this.addEventListener("childadded",e)},width:{get:function(){return this._width},set:function(t){this._width=t,this._element.style.width=t+"px"}},height:{get:function(){return this._height},set:function(t){this._height=t,this._element.style.height=t+"px"}},addChild:function(t){this.childNodes.push(t),t.parentNode=this;var e=new h.Event("childadded");if(e.node=t,e.next=null,this.dispatchEvent(e),t.dispatchEvent(new h.Event("added")),this.scene){t.scene=this.scene;var n=new h.Event("addedtoscene");t.dispatchEvent(n)}},insertBefore:function(t,e){var n=this.childNodes.indexOf(e);if(-1!==n){this.childNodes.splice(n,0,t),t.parentNode=this;var i=new h.Event("childadded");if(i.node=t,i.next=e,this.dispatchEvent(i),t.dispatchEvent(new h.Event("added")),this.scene){t.scene=this.scene;var r=new h.Event("addedtoscene");t.dispatchEvent(r)}}else this.addChild(t)},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe),this._onexitframe()},_stopRendering:function(){this.removeEventListener("exitframe",this._onexitframe),this._onexitframe()},_onexitframe:function(){this._rendering(this,new h.Event(h.Event.RENDER))},_rendering:function(t,e,n){var i;if(n||(n=[1,0,0,1,0,0]),t.dispatchEvent(e),t._domManager.render(n),t.childNodes)for(var r=0,o=t.childNodes.length;r<o;r++)i=t.childNodes[r],this._rendering(i,e,n.slice());t._domManager instanceof h.DomlessManager&&h.Matrix.instance.stack.pop(),t._dirty=!1},_determineEventTarget:function(){var t=this._touchEventTarget;return this._touchEventTarget=null,t===this?null:t}}))._attachDomManager=function(t,e,n){var i;if(t._domManager||(t.addEventListener("childadded",e),t.addEventListener("childremoved",n),t instanceof h.Group?t._domManager=new h.DomlessManager(t):t._element?t._domManager=new h.DomManager(t,t._element):t._domManager=new h.DomManager(t,"div")),t.childNodes)for(var r=0,o=t.childNodes.length;r<o;r++)i=t.childNodes[r],h.DomLayer._attachDomManager(i,e,n),t._domManager.addManager(i._domManager,null)},h.DomLayer._detachDomManager=function(t,e,n){var i;if(t.removeEventListener("childadded",e),t.removeEventListener("childremoved",n),t.childNodes)for(var r=0,o=t.childNodes.length;r<o;r++)i=t.childNodes[r],t._domManager.removeManager(i._domManager,null),h.DomLayer._detachDomManager(i,e,n);t._domManager.remove(),delete t._domManager},(h.CanvasLayer=h.Class.create(h.Group,{initialize:function(){var t=h.Core.instance;h.Group.call(this),this._cvsCache={matrix:[1,0,0,1,0,0],detectColor:"#000000"},this._cvsCache.layer=this,this._element=document.createElement("canvas"),this._element.style.position="absolute",this._element.style.left=this._element.style.top="0px",this._detect=document.createElement("canvas"),this._detect.style.position="absolute",this._lastDetected=0,this.context=this._element.getContext("2d"),this._dctx=this._detect.getContext("2d"),this._setImageSmoothingEnable(),this._colorManager=new h.DetectColorManager(16,256),this.width=t.width,this.height=t.height,[h.Event.TOUCH_START,h.Event.TOUCH_MOVE,h.Event.TOUCH_END].forEach((function(t){this.addEventListener(t,(function(t){this._scene&&this._scene.dispatchEvent(t)}))}),this);var e=function t(e){var i,r=e.node,o=e.target;i=o instanceof h.CanvasLayer?o._scene._layers.Canvas:o.scene._layers.Canvas,h.CanvasLayer._attachCache(r,i,t,n);var s=new h.Event(h.Event.RENDER);o._dirty&&o._updateCoordinate(),r._dirty=!0,h.Matrix.instance.stack.push(o._matrix),h.CanvasRenderer.instance.render(i.context,r,s),h.Matrix.instance.stack.pop(o._matrix)},n=function t(n){var i,r=n.node,o=n.target;i=o instanceof h.CanvasLayer?o._scene._layers.Canvas:o.scene._layers.Canvas,h.CanvasLayer._detachCache(r,i,e,t)};this.addEventListener("childremoved",n),this.addEventListener("childadded",e)},width:{get:function(){return this._width},set:function(t){this._width=t,this._element.width=this._detect.width=t,this._setImageSmoothingEnable()}},height:{get:function(){return this._height},set:function(t){this._height=t,this._element.height=this._detect.height=t,this._setImageSmoothingEnable()}},addChild:function(t){this.childNodes.push(t),t.parentNode=this;var e=new h.Event("childadded");e.node=t,e.next=null,this.dispatchEvent(e),t.dispatchEvent(new h.Event("added"))},insertBefore:function(t,e){var n=this.childNodes.indexOf(e);if(-1!==n){this.childNodes.splice(n,0,t),t.parentNode=this;var i=new h.Event("childadded");i.node=t,i.next=e,this.dispatchEvent(i),t.dispatchEvent(new h.Event("added"))}else this.addChild(t)},_startRendering:function(){this.addEventListener("exitframe",this._onexitframe),this._onexitframe()},_stopRendering:function(){this.removeEventListener("exitframe",this._onexitframe),this._onexitframe()},_onexitframe:function(){var t=h.Core.instance,e=this.context;e.clearRect(0,0,t.width,t.height);var n=new h.Event(h.Event.RENDER);h.CanvasRenderer.instance.render(e,this,n)},_determineEventTarget:function(t){return this._getEntityByPosition(t.x,t.y)},_getEntityByPosition:function(t,e){var n=h.Core.instance,i=this._dctx;this._lastDetected<n.frame&&(i.clearRect(0,0,this.width,this.height),h.CanvasRenderer.instance.detectRender(i,this),this._lastDetected=n.frame);var r=h.ENV.COLOR_DETECTION_LEVEL-1,o=i.getImageData(t-r,e-r,1+2*r,1+2*r).data;return this._colorManager.getSpriteByColors(o)},_setImageSmoothingEnable:function(){this._dctx.imageSmoothingEnabled=this._dctx.msImageSmoothingEnabled=this._dctx.mozImageSmoothingEnabled=this._dctx.webkitImageSmoothingEnabled=!1}}))._attachCache=function(t,e,n,i){var r;if(t._cvsCache||(t._cvsCache={},t._cvsCache.matrix=[1,0,0,1,0,0],t._cvsCache.detectColor="rgba("+e._colorManager.attachDetectColor(t)+")",t.addEventListener("childadded",n),t.addEventListener("childremoved",i)),t.childNodes)for(var o=0,s=t.childNodes.length;o<s;o++)r=t.childNodes[o],h.CanvasLayer._attachCache(r,e,n,i)},h.CanvasLayer._detachCache=function(t,e,n,i){var r;if(t._cvsCache&&(e._colorManager.detachDetectColor(t),t.removeEventListener("childadded",n),t.removeEventListener("childremoved",i),delete t._cvsCache),t.childNodes)for(var o=0,s=t.childNodes.length;o<s;o++)r=t.childNodes[o],h.CanvasLayer._detachCache(r,e,n,i)},(h.CanvasRenderer=h.Class.create({render:function(t,e,n){var i,r,o;if(t.save(),e.dispatchEvent(n),this.transform(t,e),(void 0===e._visible||e._visible)&&(i=e.width,r=e.height,e.compositeOperation&&(t.globalCompositeOperation=e.compositeOperation),t.globalAlpha="number"==typeof e._opacity?e._opacity:1,e._backgroundColor&&(t.fillStyle=e._backgroundColor,t.fillRect(0,0,i,r)),e.cvsRender&&e.cvsRender(t),h.Core.instance._debug&&e._debugColor&&(t.strokeStyle=e._debugColor,t.strokeRect(0,0,i,r)),e._clipping&&(t.beginPath(),t.rect(0,0,i,r),t.clip()),e.childNodes))for(var s=0,a=e.childNodes.length;s<a;s++)o=e.childNodes[s],this.render(t,o,n);t.restore(),h.Matrix.instance.stack.pop()},detectRender:function(t,e){var n,i,r;if(void 0===e._visible||e._visible){if(n=e.width,i=e.height,t.save(),this.transform(t,e),t.fillStyle=e._cvsCache.detectColor,e._touchEnabled&&(e.detectRender?e.detectRender(t):t.fillRect(0,0,n,i)),e._clipping&&(t.beginPath(),t.rect(0,0,n,i),t.clip()),e.childNodes)for(var o=0,s=e.childNodes.length;o<s;o++)r=e.childNodes[o],this.detectRender(t,r);t.restore(),h.Matrix.instance.stack.pop()}},transform:function(t,e){var n,i,r,o,s=h.Matrix.instance,a=s.stack;e._dirty?(s.makeTransformMatrix(e,e._cvsCache.matrix),n=[],s.multiply(a[a.length-1],e._cvsCache.matrix,n),e._matrix=n,o=[i="number"==typeof e._originX?e._originX:e._width/2||0,r="number"==typeof e._originY?e._originY:e._height/2||0],s.multiplyVec(n,o,o),e._offsetX=o[0]-i,e._offsetY=o[1]-r,e._dirty=!1):n=e._matrix,a.push(n),t.setTransform.apply(t,n)}})).instance=new h.CanvasRenderer,h.Scene=h.Class.create(h.Group,{initialize:function(){var t=h.Core.instance;h.Group.call(this),this.scene=this,this._backgroundColor=null,this._element=document.createElement("div"),this._element.style.position="absolute",this._element.style.overflow="hidden",this._element.style[h.ENV.VENDOR_PREFIX+"TransformOrigin"]="0 0",this._layers={},this._layerPriority=[],this.addEventListener(h.Event.CHILD_ADDED,this._onchildadded),this.addEventListener(h.Event.CHILD_REMOVED,this._onchildremoved),this.addEventListener(h.Event.ENTER,this._onenter),this.addEventListener(h.Event.EXIT,this._onexit);var e=this;this._dispatchExitframe=function(){for(var t in e._layers)e._layers[t].dispatchEvent(new h.Event(h.Event.EXIT_FRAME))},this.addEventListener(h.Event.CORE_RESIZE,this._oncoreresize),this._oncoreresize(t)},x:{get:function(){return this._x},set:function(t){for(var e in this._x=t,this._layers)this._layers[e].x=t}},y:{get:function(){return this._y},set:function(t){for(var e in this._y=t,this._layers)this._layers[e].y=t}},width:{get:function(){return this._width},set:function(t){for(var e in this._width=t,this._layers)this._layers[e].width=t}},height:{get:function(){return this._height},set:function(t){for(var e in this._height=t,this._layers)this._layers[e].height=t}},rotation:{get:function(){return this._rotation},set:function(t){for(var e in this._rotation=t,this._layers)this._layers[e].rotation=t}},scaleX:{get:function(){return this._scaleX},set:function(t){for(var e in this._scaleX=t,this._layers)this._layers[e].scaleX=t}},scaleY:{get:function(){return this._scaleY},set:function(t){for(var e in this._scaleY=t,this._layers)this._layers[e].scaleY=t}},backgroundColor:{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=this._element.style.backgroundColor=t}},remove:function(){for(this.clearEventListener();this.childNodes.length>0;)this.childNodes[0].remove();return h.Core.instance.removeScene(this)},_oncoreresize:function(t){for(var e in this._element.style.width=t.width+"px",this.width=t.width,this._element.style.height=t.height+"px",this.height=t.height,this._element.style[h.ENV.VENDOR_PREFIX+"Transform"]="scale("+t.scale+")",this._layers)this._layers[e].dispatchEvent(t)},addLayer:function(t,e){var n=h.Core.instance;if(!this._layers[t]){var i=new h[t+"Layer"];n.currentScene===this&&i._startRendering(),this._layers[t]=i;var r=i._element;if("number"==typeof e){var o=this._element.childNodes[e];o?this._element.insertBefore(r,o):this._element.appendChild(r),this._layerPriority.splice(e,0,t)}else this._element.appendChild(r),this._layerPriority.push(t);i._scene=this}},_determineEventTarget:function(t){for(var e,n=this._layerPriority.length-1;n>=0&&!(e=this._layers[this._layerPriority[n]]._determineEventTarget(t));n--);return e||(e=this),e},_onchildadded:function(t){var e,n,i=t.node,r=t.next;i._element?(e="Dom",n=1):(e="Canvas",n=0),this._layers[e]||this.addLayer(e,n),i._layer=this._layers[e],this._layers[e].insertBefore(i,r),i.parentNode=this},_onchildremoved:function(t){var e=t.node;e._layer.removeChild(e),e._layer=null},_onenter:function(){for(var t in this._layers)this._layers[t]._startRendering();h.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){for(var t in this._layers)this._layers[t]._stopRendering();h.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),h.LoadingScene=h.Class.create(h.Scene,{initialize:function(){h.Scene.call(this),this.backgroundColor="#000";var t=.4*this.width|0,e=.05*this.width|0,n=.03*t|0,i=new h.Sprite(t,e);i.disableCollection(),i.x=(this.width-t)/2,i.y=(this.height-e)/2;var r=new h.Surface(t,e);r.context.fillStyle="#fff",r.context.fillRect(0,0,t,e),r.context.fillStyle="#000",r.context.fillRect(n,n,t-2*n,e-2*n),i.image=r;var o=0,s=0;this.addEventListener("progress",(function(t){o=t.loaded/t.total*1})),i.addEventListener("enterframe",(function(){s*=.9,s+=.1*o,r.context.fillStyle="#fff",r.context.fillRect(n,0,(t-2*n)*s,e)})),this.addChild(i),this.addEventListener("load",(function(t){var e=h.Core.instance;e.removeScene(e.loadingScene),e.dispatchEvent(t)}))}}),h.CanvasScene=h.Class.create(h.Scene,{initialize:function(){h.Scene.call(this),this.addLayer("Canvas")},_determineEventTarget:function(t){var e=this._layers.Canvas._determineEventTarget(t);return e||(e=this),e},_onchildadded:function(t){var e=t.node,n=t.next;e._layer=this._layers.Canvas,this._layers.Canvas.insertBefore(e,n)},_onenter:function(){this._layers.Canvas._startRendering(),h.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Canvas._stopRendering(),h.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),h.DOMScene=h.Class.create(h.Scene,{initialize:function(){h.Scene.call(this),this.addLayer("Dom")},_determineEventTarget:function(t){var e=this._layers.Dom._determineEventTarget(t);return e||(e=this),e},_onchildadded:function(t){var e=t.node,n=t.next;e._layer=this._layers.Dom,this._layers.Dom.insertBefore(e,n)},_onenter:function(){this._layers.Dom._startRendering(),h.Core.instance.addEventListener("exitframe",this._dispatchExitframe)},_onexit:function(){this._layers.Dom._stopRendering(),h.Core.instance.removeEventListener("exitframe",this._dispatchExitframe)}}),(h.Surface=h.Class.create(h.EventTarget,{initialize:function(t,e){h.EventTarget.call(this);var n=h.Core.instance;this.width=Math.ceil(t),this.height=Math.ceil(e),this.context=null;var i="enchant-surface"+n._surfaceID++;if(document.getCSSCanvasContext){this.context=document.getCSSCanvasContext("2d",i,t,e),this._element=this.context.canvas,this._css="-webkit-canvas("+i+")";this.context}else document.mozSetImageElement?(this._element=document.createElement("canvas"),this._element.width=t,this._element.height=e,this._css="-moz-element(#"+i+")",this.context=this._element.getContext("2d"),document.mozSetImageElement(i,this._element)):(this._element=document.createElement("canvas"),this._element.width=t,this._element.height=e,this._element.style.position="absolute",this.context=this._element.getContext("2d"),h.ENV.CANVAS_DRAWING_METHODS.forEach((function(t){var e=this.context[t];this.context[t]=function(){e.apply(this,arguments),this._dirty=!0}}),this))},getPixel:function(t,e){return this.context.getImageData(t,e,1,1).data},setPixel:function(t,e,n,i,r,o){var s=this.context.createImageData(1,1);s.data[0]=n,s.data[1]=i,s.data[2]=r,s.data[3]=o,this.context.putImageData(s,t,e)},clear:function(){this.context.clearRect(0,0,this.width,this.height)},draw:function(t){if(t=t._element,1===arguments.length)this.context.drawImage(t,0,0);else{var e=arguments;e[0]=t,this.context.drawImage.apply(this.context,e)}},clone:function(){var t=new h.Surface(this.width,this.height);return t.draw(this),t},toDataURL:function(){var t=this._element.src;return t?"data:"===t.slice(0,5)?t:this.clone().toDataURL():this._element.toDataURL()}})).load=function(t,e,n){var i=new Image,r=Object.create(h.Surface.prototype,{context:{value:null},_css:{value:"url("+t+")"},_element:{value:i}});return h.EventTarget.call(r),n=n||function(){},r.addEventListener("load",e),r.addEventListener("error",n),i.onerror=function(){var t=new h.Event(h.Event.ERROR);t.message="Cannot load an asset: "+i.src,h.Core.instance.dispatchEvent(t),r.dispatchEvent(t)},i.onload=function(){r.width=i.width,r.height=i.height,r.dispatchEvent(new h.Event("load"))},i.src=t,r},h.Surface._staticCanvas2DContext=document.createElement("canvas").getContext("2d"),h.Surface._getPattern=function(t,e){return t._pattern&&!e||(t._pattern=this._staticCanvas2DContext.createPattern(t._element,"repeat")),t._pattern},t.Deferred?h.Deferred=t.Deferred:((h.Deferred=h.Class.create({initialize:function(){this._succ=this._fail=this._next=this._id=null,this._tail=this},next:function(t){var e=new h.Deferred;return e._succ=t,this._add(e)},error:function(t){var e=new h.Deferred;return e._fail=t,this._add(e)},_add:function(t){return this._tail._next=t,this._tail=t,this},call:function(t){for(var e,n=this;n&&!n._succ;)n=n._next;if(n instanceof h.Deferred){try{e=n._succ(t)}catch(t){return n.fail(t)}e instanceof h.Deferred?h.Deferred._insert(n,e):n._next instanceof h.Deferred&&n._next.call(e)}},fail:function(t){for(var e,n,i=this;i&&!i._fail;)i=i._next;if(!(i instanceof h.Deferred))throw t instanceof Error?t:((n=new Error("failed in Deferred")).arg=t,n);e=i._fail(t),i.call(e)}}))._insert=function(t,e){t._next instanceof h.Deferred&&(e._tail._next=t._next),t._next=e},h.Deferred.next=function(t){var e=(new h.Deferred).next(t);return e._id=setTimeout((function(){e.call()}),0),e},h.Deferred.parallel=function(t){var e=new h.Deferred;e._id=setTimeout((function(){e.call()}),0);var n=0,i=t instanceof Array?[]:{},r=new h.Deferred;for(var o in t)t.hasOwnProperty(o)&&(n++,function(t,e){t.next((function(t){n--,i[e]=t,n<=0&&r.call(i)})).error((function(t){r.fail(t)})),"number"==typeof t._id&&clearTimeout(t._id),t._id=setTimeout((function(){t.call()}),0)}(t[o],o));return n||(r._id=setTimeout((function(){r.call(i)}),0)),e.next((function(){return r}))}),(h.DOMSound=h.Class.create(h.EventTarget,{initialize:function(){throw h.EventTarget.call(this),this.duration=0,new Error("Illegal Constructor")},play:function(){this._element&&this._element.play()},pause:function(){this._element&&this._element.pause()},stop:function(){this.pause(),this.currentTime=0},clone:function(){var t;if(this._element instanceof Audio)t=Object.create(h.DOMSound.prototype,{_element:{value:this._element.cloneNode(!1)},duration:{value:this.duration}});else{if(h.ENV.USE_FLASH_SOUND)return this;t=Object.create(h.DOMSound.prototype)}return h.EventTarget.call(t),t},currentTime:{get:function(){return this._element?this._element.currentTime:0},set:function(t){this._element&&(this._element.currentTime=t)}},volume:{get:function(){return this._element?this._element.volume:1},set:function(t){this._element&&(this._element.volume=t)}}})).load=function(e,n,i,r){if(null==n){var o=h.Core.findExt(e);n=o?"audio/"+o:""}n=n.replace("mp3","mpeg").replace("m4a","mp4"),i=i||function(){},r=r||function(){};var s=Object.create(h.DOMSound.prototype);h.EventTarget.call(s),s.addEventListener("load",i),s.addEventListener("error",r);var a=new Audio;if(!h.ENV.SOUND_ENABLED_ON_MOBILE_SAFARI&&"webkit"===h.ENV.VENDOR_PREFIX&&h.ENV.TOUCH_ENABLED)t.setTimeout((function(){s.dispatchEvent(new h.Event("load"))}),0);else if(!h.ENV.USE_FLASH_SOUND&&a.canPlayType(n))a.addEventListener("canplaythrough",(function t(){s.duration=a.duration,s.dispatchEvent(new h.Event("load")),a.removeEventListener("canplaythrough",t)}),!1),a.src=e,a.load(),a.autoplay=!1,a.onerror=function(){var t=new h.Event(h.Event.ERROR);t.message="Cannot load an asset: "+a.src,h.Core.instance.dispatchEvent(t),s.dispatchEvent(t)},s._element=a;else if("audio/mpeg"===n){var c=document.createElement("embed"),u="enchant-audio"+h.Core.instance._soundID++;c.width=c.height=1,c.name=u,c.src="sound.swf?id="+u+"&src="+e,c.allowscriptaccess="always",c.style.position="absolute",c.style.left="-1px",s.addEventListener("load",(function(){Object.defineProperties(c,{currentTime:{get:function(){return c.getCurrentTime()},set:function(t){c.setCurrentTime(t)}},volume:{get:function(){return c.getVolume()},set:function(t){c.setVolume(t)}}}),s._element=c,s.duration=c.getDuration()})),h.Core.instance._element.appendChild(c),h.DOMSound[u]=s}else t.setTimeout((function(){s.dispatchEvent(new h.Event("load"))}),0);return s},t.AudioContext=t.AudioContext||t.webkitAudioContext||t.mozAudioContext||t.msAudioContext||t.oAudioContext,(h.WebAudioSound=h.Class.create(h.EventTarget,{initialize:function(){if(!t.AudioContext)throw new Error("This browser does not support WebAudio API.");h.EventTarget.call(this),h.WebAudioSound.audioContext||(h.WebAudioSound.audioContext=new t.AudioContext,h.WebAudioSound.destination=h.WebAudioSound.audioContext.destination),this.context=h.WebAudioSound.audioContext,this.src=this.context.createBufferSource(),this.buffer=null,this._volume=1,this._currentTime=0,this._state=0,this.connectTarget=h.WebAudioSound.destination},play:function(t){1!==this._state||t||this.src.disconnect(),2!==this._state&&(this._currentTime=0);var e=this._currentTime,n=this.context;this.src=n.createBufferSource(),null!=n.createGain?this._gain=n.createGain():this._gain=n.createGainNode(),this.src.buffer=this.buffer,this._gain.gain.value=this._volume,this.src.connect(this._gain),this._gain.connect(this.connectTarget),null!=this.src.start?this.src.start(0,e,this.buffer.duration-e-1.192e-7):this.src.noteGrainOn(0,e,this.buffer.duration-e-1.192e-7),this._startTime=n.currentTime-this._currentTime,this._state=1},pause:function(){var t=this.currentTime;t!==this.duration&&(null!=this.src.stop?this.src.stop(0):this.src.noteOff(0),this._currentTime=t,this._state=2)},stop:function(){null!=this.src.stop?this.src.stop(0):this.src.noteOff(0),this._state=0},clone:function(){var t=new h.WebAudioSound;return t.buffer=this.buffer,t},duration:{get:function(){return this.buffer?this.buffer.duration:0}},volume:{get:function(){return this._volume},set:function(t){t=Math.max(0,Math.min(1,t)),this._volume=t,this.src&&(this._gain.gain.value=t)}},currentTime:{get:function(){return Math.max(0,Math.min(this.duration,this.src.context.currentTime-this._startTime))},set:function(t){this._currentTime=t,2!==this._state&&this.play(!1)}}})).load=function(t,e,n,i){var r,o,s=(new Audio).canPlayType(e),a=new h.WebAudioSound;function c(){var e=new h.Event(h.Event.ERROR);e.message="Cannot load an asset: "+t,h.Core.instance.dispatchEvent(e),a.dispatchEvent(e)}return n=n||function(){},i=i||function(){},a.addEventListener(h.Event.LOAD,n),a.addEventListener(h.Event.ERROR,i),"maybe"===s||"probably"===s?(r=h.WebAudioSound.audioContext,(o=new XMLHttpRequest).open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){r.decodeAudioData(o.response,(function(t){a.buffer=t,a.dispatchEvent(new h.Event(h.Event.LOAD))}),c)},o.onerror=c,o.send(null)):setTimeout(c,50),a},h.Sound=t.AudioContext&&h.ENV.USE_WEBAUDIO?h.WebAudioSound:h.DOMSound,h.Easing={LINEAR:function(t,e,n,i){return n*t/i+e},SWING:function(t,e,n,i){return n*(.5-Math.cos(t/i*Math.PI)/2)+e},QUAD_EASEIN:function(t,e,n,i){return n*(t/=i)*t+e},QUAD_EASEOUT:function(t,e,n,i){return-n*(t/=i)*(t-2)+e},QUAD_EASEINOUT:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t+e:-n/2*(--t*(t-2)-1)+e},CUBIC_EASEIN:function(t,e,n,i){return n*(t/=i)*t*t+e},CUBIC_EASEOUT:function(t,e,n,i){return n*((t=t/i-1)*t*t+1)+e},CUBIC_EASEINOUT:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t+e:n/2*((t-=2)*t*t+2)+e},QUART_EASEIN:function(t,e,n,i){return n*(t/=i)*t*t*t+e},QUART_EASEOUT:function(t,e,n,i){return-n*((t=t/i-1)*t*t*t-1)+e},QUART_EASEINOUT:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t+e:-n/2*((t-=2)*t*t*t-2)+e},QUINT_EASEIN:function(t,e,n,i){return n*(t/=i)*t*t*t*t+e},QUINT_EASEOUT:function(t,e,n,i){return n*((t=t/i-1)*t*t*t*t+1)+e},QUINT_EASEINOUT:function(t,e,n,i){return(t/=i/2)<1?n/2*t*t*t*t*t+e:n/2*((t-=2)*t*t*t*t+2)+e},SIN_EASEIN:function(t,e,n,i){return-n*Math.cos(t/i*(Math.PI/2))+n+e},SIN_EASEOUT:function(t,e,n,i){return n*Math.sin(t/i*(Math.PI/2))+e},SIN_EASEINOUT:function(t,e,n,i){return-n/2*(Math.cos(Math.PI*t/i)-1)+e},CIRC_EASEIN:function(t,e,n,i){return-n*(Math.sqrt(1-(t/=i)*t)-1)+e},CIRC_EASEOUT:function(t,e,n,i){return n*Math.sqrt(1-(t=t/i-1)*t)+e},CIRC_EASEINOUT:function(t,e,n,i){return(t/=i/2)<1?-n/2*(Math.sqrt(1-t*t)-1)+e:n/2*(Math.sqrt(1-(t-=2)*t)+1)+e},ELASTIC_EASEIN:function(t,e,n,i,r,o){return 0===t?e:1==(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/r),-r*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*(2*Math.PI)/o)+e);var s},ELASTIC_EASEOUT:function(t,e,n,i,r,o){return 0===t?e:1==(t/=i)?e+n:(o||(o=.3*i),!r||r<Math.abs(n)?(r=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/r),r*Math.pow(2,-10*t)*Math.sin((t*i-s)*(2*Math.PI)/o)+n+e);var s},ELASTIC_EASEINOUT:function(t,e,n,i,r,o){return 0===t?e:2==(t/=i/2)?e+n:(o||(o=i*(.3*1.5)),!r||r<Math.abs(n)?(r=n,s=o/4):s=o/(2*Math.PI)*Math.asin(n/r),t<1?r*Math.pow(2,10*(t-=1))*Math.sin((t*i-s)*(2*Math.PI)/o)*-.5+e:r*Math.pow(2,-10*(t-=1))*Math.sin((t*i-s)*(2*Math.PI)/o)*.5+n+e);var s},BOUNCE_EASEOUT:function(t,e,n,i){return(t/=i)<1/2.75?n*(7.5625*t*t)+e:t<2/2.75?n*(7.5625*(t-=1.5/2.75)*t+.75)+e:t<2.5/2.75?n*(7.5625*(t-=2.25/2.75)*t+.9375)+e:n*(7.5625*(t-=2.625/2.75)*t+.984375)+e},BOUNCE_EASEIN:function(t,e,n,i){return n-h.Easing.BOUNCE_EASEOUT(i-t,0,n,i)+e},BOUNCE_EASEINOUT:function(t,e,n,i){return t<i/2?.5*h.Easing.BOUNCE_EASEIN(2*t,0,n,i)+e:.5*h.Easing.BOUNCE_EASEOUT(2*t-i,0,n,i)+.5*n+e},BACK_EASEIN:function(t,e,n,i,r){return void 0===r&&(r=1.70158),n*(t/=i)*t*((r+1)*t-r)+e},BACK_EASEOUT:function(t,e,n,i,r){return void 0===r&&(r=1.70158),n*((t=t/i-1)*t*((r+1)*t+r)+1)+e},BACK_EASEINOUT:function(t,e,n,i,r){return void 0===r&&(r=1.70158),(t/=i/2)<1?n/2*(t*t*((1+(r*=1.525))*t-r))+e:n/2*((t-=2)*t*((1+(r*=1.525))*t+r)+2)+e},EXPO_EASEIN:function(t,e,n,i){return 0===t?e:n*Math.pow(2,10*(t/i-1))+e},EXPO_EASEOUT:function(t,e,n,i){return t===i?e+n:n*(1-Math.pow(2,-10*t/i))+e},EXPO_EASEINOUT:function(t,e,n,i){return 0===t?e:t===i?e+n:(t/=i/2)<1?n/2*Math.pow(2,10*(t-1))+e:n/2*(2-Math.pow(2,-10*--t))+e}},h.ActionEventTarget=h.Class.create(h.EventTarget,{initialize:function(){h.EventTarget.apply(this,arguments)},dispatchEvent:function(t){var e=this.node?this.node:this;t.target=e,t.localX=t.x-e._offsetX,t.localY=t.y-e._offsetY,null!=this["on"+t.type]&&this["on"+t.type].call(e,t);var n=this._listeners[t.type];if(null!=n)for(var i=0,r=(n=n.slice()).length;i<r;i++)n[i].call(e,t)}}),h.Timeline=h.Class.create(h.EventTarget,{initialize:function(t){h.EventTarget.call(this),this.node=t,this.queue=[],this.paused=!1,this.looped=!1,this.isFrameBased=!0,this._parallel=null,this._activated=!1,this.addEventListener(h.Event.ENTER_FRAME,this._onenterframe);var e=this;this._nodeEventListener=function(t){e.dispatchEvent(t)}},_deactivateTimeline:function(){this._activated&&(this._activated=!1,this.node.removeEventListener("enterframe",this._nodeEventListener))},_activateTimeline:function(){this._activated||this.paused||(this.node.addEventListener("enterframe",this._nodeEventListener),this._activated=!0)},_onenterframe:function(t){this.paused||this.tick(this.isFrameBased?1:t.elapsed)},setFrameBased:function(){this.isFrameBased=!0},setTimeBased:function(){this.isFrameBased=!1},next:function(t){var e,n=this.queue.shift();if(n&&((e=new h.Event("actionend")).timeline=this,n.dispatchEvent(e),(e=new h.Event("removedfromtimeline")).timeline=this,n.dispatchEvent(e),this.looped&&this.add(n)),0!==this.queue.length){if(t>0||this.queue[0]&&0===this.queue[0].time){var i=new h.Event("actiontick");i.elapsed=t,i.timeline=this,this.queue[0].dispatchEvent(i)}}else this._deactivateTimeline()},tick:function(t){if(this.queue.length>0){var e,n=this.queue[0];if(0===n.frame)(e=new h.Event("actionstart")).timeline=this,n.dispatchEvent(e);var i=new h.Event("actiontick");i.timeline=this,i.elapsed=t,n.dispatchEvent(i)}},add:function(t){this._activateTimeline(),this._parallel?(this._parallel.actions.push(t),this._parallel=null):this.queue.push(t),t.frame=0;var e=new h.Event("addedtotimeline");return e.timeline=this,t.dispatchEvent(e),(e=new h.Event("actionadded")).action=t,this.dispatchEvent(e),this},action:function(t){return this.add(new h.Action(t))},tween:function(t){return this.add(new h.Tween(t))},clear:function(){var t=new h.Event("removedfromtimeline");t.timeline=this;for(var e=0,n=this.queue.length;e<n;e++)this.queue[e].dispatchEvent(t);return this.queue=[],this._deactivateTimeline(),this},skip:function(t){var e=new h.Event("enterframe");for(this.isFrameBased?e.elapsed=1:(e.elapsed=t,t=1);t--;)this.dispatchEvent(e);return this},pause:function(){return this.paused||(this.paused=!0,this._deactivateTimeline()),this},resume:function(){return this.paused&&(this.paused=!1,this._activateTimeline()),this},loop:function(){return this.looped=!0,this},unloop:function(){return this.looped=!1,this},delay:function(t){return this.action({time:t})},wait:function(t){return this},then:function(t){return this.action({onactiontick:function(e){t.call(this)},time:0})},exec:function(t){return this.then(t)},cue:function(t){var e=0;for(var n in t)t.hasOwnProperty(n)&&(this.delay(n-e),this.then(t[n]),e=n);return this},repeat:function(t,e){return this.action({onactiontick:function(e){t.call(this)},time:e})},and:function(){var t=this.queue.pop();if(t instanceof h.ParallelAction)this._parallel=t,this.queue.push(t);else{var e=new h.ParallelAction;e.actions.push(t),this.queue.push(e),this._parallel=e}return this},or:function(){return this},doAll:function(t){return this},waitAll:function(){return this},waitUntil:function(t){return this.action({onactiontick:function(e){t.call(this)&&e.timeline.next()}})},fadeTo:function(t,e,n){return this.tween({opacity:t,time:e,easing:n})},fadeIn:function(t,e){return this.fadeTo(1,t,e)},fadeOut:function(t,e){return this.fadeTo(0,t,e)},moveTo:function(t,e,n,i){return this.tween({x:t,y:e,time:n,easing:i})},moveX:function(t,e,n){return this.tween({x:t,time:e,easing:n})},moveY:function(t,e,n){return this.tween({y:t,time:e,easing:n})},moveBy:function(t,e,n,i){return this.tween({x:function(){return this.x+t},y:function(){return this.y+e},time:n,easing:i})},hide:function(){return this.then((function(){this.opacity=0}))},show:function(){return this.then((function(){this.opacity=1}))},removeFromScene:function(){return this.then((function(){this.parentNode.removeChild(this)}))},scaleTo:function(t,e,n){var i,r;return"number"==typeof n?(i=arguments[0],r=arguments[1],e=arguments[2],n=arguments[3]):i=r=t,this.tween({scaleX:i,scaleY:r,time:e,easing:n})},scaleBy:function(t,e,n){var i,r;return"number"==typeof n?(i=arguments[0],r=arguments[1],e=arguments[2],n=arguments[3]):i=r=t,this.tween({scaleX:function(){return this.scaleX*i},scaleY:function(){return this.scaleY*r},time:e,easing:n})},rotateTo:function(t,e,n){return this.tween({rotation:t,time:e,easing:n})},rotateBy:function(t,e,n){return this.tween({rotation:function(){return this.rotation+t},time:e,easing:n})}}),h.Action=h.Class.create(h.ActionEventTarget,{initialize:function(t){for(var e in h.ActionEventTarget.call(this),this.time=null,this.frame=0,t)t.hasOwnProperty(e)&&null!=t[e]&&(this[e]=t[e]);var n=this;this.timeline=null,this.node=null,this.addEventListener(h.Event.ADDED_TO_TIMELINE,(function(t){n.timeline=t.timeline,n.node=t.timeline.node,n.frame=0})),this.addEventListener(h.Event.REMOVED_FROM_TIMELINE,(function(){n.timeline=null,n.node=null,n.frame=0})),this.addEventListener(h.Event.ACTION_TICK,(function(t){var e=n.time-(n.frame+t.elapsed);null!=n.time&&e<=0?(n.frame=n.time,t.timeline.next(-e)):n.frame+=t.elapsed}))}}),h.ParallelAction=h.Class.create(h.Action,{initialize:function(t){h.Action.call(this,t),this.actions=[],this.endedActions=[];var e=this;this.addEventListener(h.Event.ACTION_START,(function(t){for(var n=0,i=e.actions.length;n<i;n++)e.actions[n].dispatchEvent(t)})),this.addEventListener(h.Event.ACTION_TICK,(function(t){var n,i,r={next:function(t){var r=e.actions[n];e.actions.splice(n--,1),i=e.actions.length,e.endedActions.push(r);var o=new h.Event("actionend");o.timeline=this,r.dispatchEvent(o),(o=new h.Event("removedfromtimeline")).timeline=this,r.dispatchEvent(o)}},o=new h.Event("actiontick");for(o.timeline=r,o.elapsed=t.elapsed,n=0,i=e.actions.length;n<i;n++)e.actions[n].dispatchEvent(o);0===e.actions.length&&t.timeline.next()})),this.addEventListener(h.Event.ADDED_TO_TIMELINE,(function(t){for(var n=0,i=e.actions.length;n<i;n++)e.actions[n].dispatchEvent(t)})),this.addEventListener(h.Event.REMOVED_FROM_TIMELINE,(function(){e.actions=e.endedActions,e.endedActions=[]}))}}),h.Tween=h.Class.create(h.Action,{initialize:function(t){var e={},n={};h.Action.call(this,t),null==this.easing&&(this.easing=h.Easing.LINEAR);var i=this;this.addEventListener(h.Event.ACTION_START,(function(){var r=["frame","time","callback","onactiontick","onactionstart","onactionend"];for(var o in t){var s;if(t.hasOwnProperty(o))s="function"==typeof t[o]?t[o].call(i.node):t[o],-1===r.indexOf(o)&&(e[o]=i.node[o],n[o]=s)}})),this.addEventListener(h.Event.ACTION_TICK,(function(t){var r=0===i.time?1:i.easing(Math.min(i.time,i.frame+t.elapsed),0,1,i.time)-i.easing(i.frame,0,1,i.time);for(var o in n)if(n.hasOwnProperty(o)){if(void 0===this[o])continue;i.node[o]+=(n[o]-e[o])*r,Math.abs(i.node[o])<1e-7&&(i.node[o]=0)}}))}})}(window)},function(t,e){enchant.ui={assets:["pad.png","apad.png","icon0.png","font0.png"]},enchant.ui.Pad=enchant.Class.create(enchant.Sprite,{initialize:function(){var t=enchant.Core.instance.assets["pad.png"];enchant.Sprite.call(this,t.width/2,t.height),this.image=t,this.input={left:!1,right:!1,up:!1,down:!1},this.addEventListener("touchstart",(function(t){this._updateInput(this._detectInput(t.localX,t.localY))})),this.addEventListener("touchmove",(function(t){this._updateInput(this._detectInput(t.localX,t.localY))})),this.addEventListener("touchend",(function(t){this._updateInput({left:!1,right:!1,up:!1,down:!1})}))},_detectInput:function(t,e){var n={left:!1,right:!1,up:!1,down:!1};return(t-=.5*this.width)*t+(e-=.5*this.height)*e<=2500&&t*t+e*e>200&&(t<0&&e<t*t*.1&&e>t*t*-.1&&(n.left=!0),t>0&&e<t*t*.1&&e>t*t*-.1&&(n.right=!0),e<0&&t<e*e*.1&&t>e*e*-.1&&(n.up=!0),e>0&&t<e*e*.1&&t>e*e*-.1&&(n.down=!0)),n},_updateInput:function(t){var e=enchant.Core.instance;["left","right","up","down"].forEach((function(n){this.input[n]&&!t[n]&&e.changeButtonState(n,!1),!this.input[n]&&t[n]&&e.changeButtonState(n,!0)}),this),this.input=t}}),enchant.ui.APad=enchant.Class.create(enchant.Group,{initialize:function(t){var e=enchant.Core.instance.assets["apad.png"],n=this.width=e.width,i=this.height=e.height;enchant.Group.call(this),this.outside=new enchant.Sprite(n,i);var r=new enchant.Surface(n,i);r.draw(e,0,0,n,i/4,0,0,n,i/4),r.draw(e,0,i/4*3,n,i/4,0,i/4*3,n,i/4),r.draw(e,0,i/4,n/4,i/2,0,i/4,n/4,i/2),r.draw(e,n/4*3,i/4,n/4,i/2,n/4*3,i/4,n/4,i/2),this.outside.image=r,this.inside=new enchant.Sprite(n/2,i/2);var o=new enchant.Surface(n/2,i/2);o.draw(e,n/4,i/4,n/2,i/2,0,0,n/2,i/2),this.inside.image=o,this.r=n/2,this.isTouched=!1,this.vx=0,this.vy=0,this.rad=0,this.dist=0,this.mode="direct"===t?"direct":"normal",this._updateImage(),this.addChild(this.inside),this.addChild(this.outside),this.addEventListener("touchstart",(function(t){this._detectInput(t.localX,t.localY),this._calcPolar(t.localX,t.localY),this._updateImage(t.localX,t.localY),this._dispatchPadEvent("apadstart"),this.isTouched=!0})),this.addEventListener("touchmove",(function(t){this._detectInput(t.localX,t.localY),this._calcPolar(t.localX,t.localY),this._updateImage(t.localX,t.localY),this._dispatchPadEvent("apadmove")})),this.addEventListener("touchend",(function(t){this._detectInput(this.width/2,this.height/2),this._calcPolar(this.width/2,this.height/2),this._updateImage(this.width/2,this.height/2),this._dispatchPadEvent("apadend"),this.isTouched=!1}))},_dispatchPadEvent:function(t){var e=new enchant.Event(t);e.vx=this.vx,e.vy=this.vy,e.rad=this.rad,e.dist=this.dist,this.dispatchEvent(e)},_updateImage:function(t,e){this.width,this.height,this.inside.x=this.vx*(this.r-10)+25,this.inside.y=this.vy*(this.r-10)+25},_detectInput:function(t,e){t-=this.width/2,e-=this.height/2;var n=Math.sqrt(t*t+e*e),i=e/t,r=Math.atan(i),o=t/Math.abs(t);0===n?(this.vx=0,this.vy=0):0===t?(this.vx=0,"direct"===this.mode?this.vy=e/this.r:(o=e/Math.abs(e),this.vy=Math.pow(e/this.r,2)*o)):n<this.r?"direct"===this.mode?(this.vx=t/this.r,this.vy=e/this.r):(this.vx=Math.pow(n/this.r,2)*Math.cos(r)*o,this.vy=Math.pow(n/this.r,2)*Math.sin(r)*o):(this.vx=Math.cos(r)*o,this.vy=Math.sin(r)*o)},_calcPolar:function(t,e){t-=this.width/2,e-=this.height/2;var n=0,i=0,r=Math.sqrt(t*t+e*e);r>this.r&&(r=this.r),r/=this.r,"normal"===this.mode&&(r*=r),t>=0&&e<0?(n=Math.PI/2*3,i=t/e):t<0&&e<=0?(n=Math.PI,i=e/t):t<=0&&e>0?(n=Math.PI/2,i=t/e):t>0&&e>=0&&(n=0,i=e/t),0!==t&&0!==e||(i=0),this.rad=Math.abs(Math.atan(i))+n,this.dist=r}}),enchant.ui.Button=enchant.Class.create(enchant.Entity,{initialize:function(t,e,n,i){enchant.Entity.call(this),enchant.CanvasLayer&&(this._element="div"),this.width=i||null,this.height=n||null,this.text=t,this.pressed=!1;var r=this._style;r.display="inline-block",r["font-size"]="12px",r.height="2em",r["line-height"]="2em",r["min-width"]="2em",r.padding="2px 10px",r["text-align"]="center",r["font-weight"]="bold",r["border-radius"]="0.5em",e=e||"dark",this.theme="string"==typeof e?enchant.ui.Button.DEFAULT_THEME[e]:e,this._applyTheme(this.theme.normal),this.addEventListener("touchstart",(function(){this._applyTheme(this.theme.active),this.pressed=!0,this.y++})),this.addEventListener("touchend",(function(){this._applyTheme(this.theme.normal),this.pressed=!1,this.y--}))},_applyTheme:function(t){var e=this._style,n=enchant.ui.Button.theme2css(t);for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])},text:{get:function(){return this._text},set:function(t){this._text=t,enchant.CanvasLayer||(this._element.innerHTML=t)}},size:{get:function(){return this._style.fontSize},set:function(t){this._style.fontSize=t}},font:{get:function(){return this._style.font},set:function(t){this._style.font=t}},color:{get:function(){return this._style.color},set:function(t){this._style.color=t}},cvsRender:function(){},domRender:function(){var t=this._domManager.element;t.innerHTML=this._text,t.style.font=this._font,t.style.color=this._color,t.style.textAlign=this._textAlign}}),enchant.ui.Button.theme2css=function(t){var e="-"+enchant.ENV.VENDOR_PREFIX.toLowerCase()+"-",n={},i=t.background,r=t.border,o=t.textShadow,s=t.boxShadow;return"-ms-"===e?n.background=i.start:n["background-image"]=e+i.type+"("+["top",i.start,i.end]+")",n.color=t.color,n.border=r.color+" "+r.width+" "+r.type,n["text-shadow"]=o.offsetX+"px "+o.offsetY+"px "+o.blur+" "+o.color,n["box-shadow"]=s.offsetX+"px "+s.offsetY+"px "+s.blur+" "+s.color,n},enchant.ui.Button.DEFAULT_THEME={dark:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#666",end:"#333"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#333",end:"#000"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},light:{normal:{color:"#333",background:{type:"linear-gradient",start:"#fff",end:"#ccc"},border:{color:"#999",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#fff"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 1)"}},active:{color:"#333",background:{type:"linear-gradient",start:"#ccc",end:"#999"},border:{color:"#666",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#ccc"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},blue:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#04f",end:"#04c"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 0.5)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#029",end:"#026"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:"none"}}},enchant.ui.MutableText=enchant.Class.create(enchant.Sprite,{initialize:function(t,e,n){enchant.Sprite.call(this,0,0),this.fontSize=16,this.widthItemNum=16,this.x=t,this.y=e,this._imageAge=Number.MAX_VALUE,this.text="",arguments[2]&&(this.row=Math.floor(arguments[2]/this.fontSize))},setText:function(t){var e,n,i,r,o;for(this._text=t,this.returnLength?this.width=Math.min(this.returnLength*this.fontSize,enchant.Game.instance.width):this.width=Math.min(this.fontSize*this._text.length,enchant.Game.instance.width),this.height=this.fontSize*(Math.ceil(this._text.length/this.row)||1),!this.image||this.width>this.image.width||this.height>this.image.height||this._imageAge>300?(this.image=new enchant.Surface(this.width,this.height),this._imageAge=0):this.width<this.image.width||this.height<this.image.height?this._imageAge++:this._imageAge=0,this.image.context.clearRect(0,0,this.width,this.height),e=0;e<t.length;e++)n=(o=(r=t.charCodeAt(e))>=32&&r<=127?r-32:0)%this.widthItemNum,i=o/this.widthItemNum|0,this.image.draw(enchant.Game.instance.assets["font0.png"],n*this.fontSize,i*this.fontSize,this.fontSize,this.fontSize,e%this.row*this.fontSize,(e/this.row|0)*this.fontSize,this.fontSize,this.fontSize)},text:{get:function(){return this._text},set:function(t){this.setText(t)}},row:{get:function(){return this.returnLength||this.width/this.fontSize},set:function(t){this.returnLength=t,this.text=this.text}}}),enchant.ui.ScoreLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(t,e){switch(enchant.ui.MutableText.call(this,0,0),arguments.length){case 2:this.y=e,this.x=t;break;case 1:this.x=t}this._score=0,this._current=0,this.easing=2.5,this.text=this.label="SCORE:",this.addEventListener("enterframe",(function(){if(0===this.easing)this.text=this.label+(this._current=this._score);else{var t=this._score-this._current;0<t?this._current+=Math.ceil(t/this.easing):t<0&&(this._current+=Math.floor(t/this.easing)),this.text=this.label+this._current}}))},score:{get:function(){return this._score},set:function(t){this._score=t}}}),enchant.ui.TimeLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(t,e,n){switch(enchant.ui.MutableText.call(this,0,0),arguments.length){case 3:case 2:this.y=e,this.x=t;break;case 1:this.x=t}this._time=0,this._count=1,"countdown"===n&&(this._count=-1),this.text=this.label="TIME:",this.addEventListener("enterframe",(function(){this._time+=this._count,this.text=this.label+(this._time/enchant.Game.instance.fps).toFixed(2)}))},time:{get:function(){return Math.floor(this._time/enchant.Game.instance.fps)},set:function(t){this._time=t*enchant.Game.instance.fps}}}),enchant.ui.LifeLabel=enchant.Class.create(enchant.Group,{initialize:function(t,e,n){enchant.Group.call(this),this.x=t||0,this.y=e||0,this._maxlife=n||9,this._life=0,this.label=new enchant.ui.MutableText(0,0,80),this.label.text="LIFE:",this.addChild(this.label),this.heart=[];for(var i=0;i<this._maxlife;i++)this.heart[i]=new enchant.Sprite(16,16),this.heart[i].image=enchant.Game.instance.assets["icon0.png"],this.heart[i].x=this.label.width+16*i,this.heart[i].y=-3,this.heart[i].frame=10,this.addChild(this.heart[i])},life:{get:function(){return this._life},set:function(t){this._life=t,this._maxlife<t&&(this._life=this._maxlife);for(var e=0;e<this._maxlife;e++)this.heart[e].visible=e<=t-1}}}),enchant.ui.Bar=enchant.Class.create(enchant.Sprite,{initialize:function(t,e){switch(enchant.Sprite.call(this,1,16),this.image=new enchant.Surface(1,16),this.image.context.fillColor="RGB(0, 0, 256)",this.image.context.fillRect(0,0,1,16),this._direction="right",this._origin=0,this._maxvalue=enchant.Game.instance.width,this._lastvalue=0,this.value=0,this.easing=5,arguments.length){case 2:this.y=e,this.x=t,this._origin=t;break;case 1:this.x=t,this._origin=t}this.addEventListener("enterframe",(function(){this.value<0&&(this.value=0),this._lastvalue+=(this.value-this._lastvalue)/this.easing,Math.abs(this._lastvalue-this.value)<1.3&&(this._lastvalue=this.value),this.width=0|this._lastvalue,this.width>this._maxvalue&&(this.width=this._maxvalue),"left"===this._direction?this._x=this._origin-this.width:this._x=this._origin,this._updateCoordinate()}))},direction:{get:function(){return this._direction},set:function(t){"right"!==t&&"left"!==t||(this._direction=t)}},x:{get:function(){return this._origin},set:function(t){this._x=t,this._origin=t,this._dirty=!0}},maxvalue:{get:function(){return this._maxvalue},set:function(t){this._maxvalue=t}}}),enchant.ui.VirtualMap=enchant.Class.create(enchant.Group,{initialize:function(t,e){enchant.Group.call(this),this.meshWidth=t||16,this.meshHeight=e||16},addChild:function(t){enchant.Group.prototype.addChild.call(this,t),this.bind(t)},insertBefore:function(t,e){enchant.Group.prototype.insertBefore.call(this,t,e),this.bind(t)},bind:function(t){Object.defineProperties(t,{mx:{get:function(){return Math.floor(this.x/this.parentNode.meshWidth)},set:function(t){this.x=Math.floor(t*this.parentNode.meshWidth)}},my:{get:function(){return Math.floor(this.y/this.parentNode.meshHeight)},set:function(t){this.y=Math.floor(t*this.parentNode.meshWidth)}}}),t.mx=0,t.my=0}})},function(t,e){enchant.avatar={},enchant.avatar.AvatarCharacter=enchant.Class.create(enchant.Sprite,{initialize:function(t,e){enchant.Sprite.call(this,t,e),this.right(),this.action="stop",this.animPattern={stop:[0]},this.animFrame=0,this.addEventListener("enterframe",(function(){if(0==(3&~~this.age)&&this.action){var t=this.animPattern[this.action];this.frame=t[this.animFrame],this.animFrame++,-1===t[this.animFrame]&&(this.animFrame=0,this.action="stop"),-2===t[this.animFrame]&&this.parentNode.removeChild(this),this.animFrame>=t.length&&(this.animFrame=0)}}))},left:function(){this.scaleX=1},right:function(){this.scaleX=-1}}),enchant.avatar.AvatarMonster=enchant.Class.create(enchant.avatar.AvatarCharacter,{initialize:function(t){var e=~~(t.width/4),n=e;enchant.avatar.AvatarCharacter.call(this,e,n),this.image=t,this.animPattern={stop:[4,4,4,3,3,3],walk:[2,3,4,3],appear:[0,1,7,6,5,4,2,3,-1],disappear:[3,2,4,5,6,7,1,0,-2],attack:[5,4,6,6,6,-1]},this.action="attack",this.left()}}),enchant.avatar.AvatarBG=enchant.Class.create(enchant.Group,{initialize:function(t){enchant.Group.call(this);var e=enchant.Core.instance;for(this.veryfarbg=new enchant.Sprite(320,51),this.veryfarbg.y=0,this.veryfarbg.image=e.assets["avatarBg2.png"],this.veryfarbg.frame=t,this.addChild(this.veryfarbg),this.farbgs=[],i=0;i<3;i++){var n=new enchant.Sprite(320,32);n.image=e.assets["avatarBg3.png"],n.frame=t,n.x=320*i-320,n.y=20,this.farbgs[this.farbgs.length]=n,this.addChild(n)}for(this.tiles=[],i=0;i<14;i++){var r=new enchant.Sprite(32,128);r.image=e.assets["avatarBg1.png"],r.frame=t,r.x=31*i-48,r.y=48,this.tiles[this.tiles.length]=r,this.addChild(r)}},scroll:function(t){var e=~~(t/2)%320,n=~~t%32*2;for(i=0;i<14;i++)this.tiles[i].x=31*i-n-48;for(i=0;i<3;i++)this.farbgs[i].x=320*i-e-320}}),enchant.avatar.Avatar=enchant.Class.create(enchant.avatar.AvatarCharacter,{initialize:function(t){enchant.avatar.AvatarCharacter.call(this,64,64),t?this.setCode(t):(this.gender=1,this.hairstyle=1,this.haircolor=0,this.weapon=2545,this.armor=2135,this.headpiece=0,this.loadImage()),this.animPattern={stop:[0],run:[1,2,3,2],attack:[0,2,9,10,11,5,0,0,0,-1],special:[0,6,5,13,14,15,0,0,-1],damage:[7,7,7,7,0,0,0,-1],dead:[8],demo:[1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,0,0,0,0,2,9,10,11,5,0,0,0,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,1,2,3,2,0,6,5,13,14,15,0,0]}},loadImage:function(){var t,e;this.opt="gender="+this.gender+"&job=0&hairstyle="+this.hairstyle+"&haircolor="+this.haircolor+"&weapon="+this.weapon+"&armor="+this.armor+"&headpiece="+this.headpiece+"&invisible=0&x=0&y=0&w=4&h=4&dummy=.gif",this.src="http://9leap.net/meruru/draw/draw.php?"+this.opt,t=this,(e=enchant.Core.instance).load(t.src,(function(){t.image=e.assets[t.src]}))},getCode:function(){return this.gender+":"+this.hairstyle+":"+this.haircolor+":"+this.weapon+":"+this.armor+":"+this.headpiece},setCode:function(t){data=t.split(":"),this.gender=data[0],this.hairstyle=data[1],this.haircolor=data[2],this.weapon=data[3],this.armor=data[4],this.headpiece=data[5],this.loadImage()}})},function(t,e,n){"use strict";n.r(e);n(1),n(2),n(3);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*(e+1-t))+t}function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var o=function(){function t(e,n,i){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.controller=i,this.item=new Sprite(e,n),this.item.x=0,this.item.y=0,this.game=i.game,this.item.on("enterframe",(function(){return r.on()}))}var e,n,o;return e=t,(n=[{key:"on",value:function(){}},{key:"random",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i(t,e)}},{key:"apply",value:function(t){return this.item.image=this.image,this.group=t,this.group.addChild(this.item),this}},{key:"remove",value:function(){return this.group?(this.group.removeChild(this.item),this):this}}])&&r(e.prototype,n),o&&r(e,o),t}();function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e){return(h=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=f(t);if(e){var r=f(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return u(this,n)}}function u(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?l(t):e}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&h(t,e)}(o,t);var e,n,i,r=c(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,16,25,t)).isJump=!1,e.GROUND_Y=468,e.item.on("touchstart",(function(){return e.touchstart()})),e.item.on("touchend",(function(){return e.touchend()})),e.item.x=50,e.item.scale(3),e.item.frame=[0,1,2],e.item.y=e.GROUND_Y,e.soundEffect=e.game.assets["bgm/se_maoudamashii_retro08.mp3"].clone(),e.image=e.game.assets["img/ninja.png"],e.runSpeed=1,e.SPEED_FLG=0,e.isBan=!1,u(e,l(e))}return e=o,(n=[{key:"touchstart",value:function(){this.isJump||(this.soundEffect.play(),this.isJump=!0,this.vy=-20,this.item.frame=0)}},{key:"touchend",value:function(){this.isJump&&this.vy<0&&(this.vy/=2)}},{key:"jump",value:function(){this.isJump&&(this.vy+=1,this.item.frame=0,this.isBan||(this.item.y+=this.vy),this.item.y>=this.GROUND_Y&&(this.item.y=this.GROUND_Y,this.isJump=!1,this.item.frame=[0,1,2]))}},{key:"runState",value:function(){this.SPEED_FLG>0&&(this.item.frame=[2]),0===this.SPEED_FLG&&(this.item.frame=[0,1,2])}},{key:"run",value:function(){this.runState(),this.controller.isSecond()&&this.oneSecond(),this.isJump||(this.item.x+=this.runSpeed)}},{key:"oneSecond",value:function(){this.SPEED_FLG>0&&(this.SPEED_FLG-=1),0===this.SPEED_FLG&&(this.runSpeed=1),0===this.SPEED_FLG&&(this.isBan=!1)}},{key:"speed",value:function(){return this.SCROLL_SPEED}},{key:"backRun",value:function(){this.runSpeed=1}},{key:"slowRun",value:function(){this.runSpeed=0,this.SPEED_FLG=1,this.isBan=!0}},{key:"on",value:function(){this.jump(),this.run()}}])&&a(e.prototype,n),i&&a(e,i),o}(o);function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function p(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _(t,e){return(_=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=E(t);if(e){var r=E(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return g(this,n)}}function g(t,e){return!e||"object"!==m(e)&&"function"!=typeof e?y(t):e}function y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function E(t){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var b=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_(t,e)}(o,t);var e,n,i,r=v(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var n=10*(e=r.call(this,171,51,t)).random(0,20);return e.item.y=n,e.item.x=640,e.item.frame=e.random(0,2),e.SPEED=n<80?e.random(2,8):e.random(0,2),e.image=e.game.assets["img/cloud.png"],g(e,y(e))}return e=o,(n=[{key:"init",value:function(){return this.item.x=15*this.random(3,64),this}},{key:"on",value:function(){this.item.x+=this.controller.scroll()+this.SPEED}}])&&p(e.prototype,n),i&&p(e,i),o}(o);function w(t){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function C(t,e){return(C=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function x(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=N(t);if(e){var r=N(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return T(this,n)}}function T(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?O(t):e}function O(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function N(t){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&C(t,e)}(o,t);var e,n,i,r=x(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,262,138,t)).item.y=351,e.item.x=640,e.item.frame=e.random(0,1),e.image=e.game.assets["img/mountain.png"],T(e,O(e))}return e=o,(n=[{key:"init",value:function(){return this.item.x=15*this.random(3,64),this}},{key:"on",value:function(){this.item.x+=this.controller.scroll()}}])&&S(e.prototype,n),i&&S(e,i),o}(o);function A(t){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function R(t,e){return(R=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function D(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=P(t);if(e){var r=P(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return L(this,n)}}function L(t,e){return!e||"object"!==A(e)&&"function"!=typeof e?I(t):e}function I(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var k=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&R(t,e)}(n,t);var e=D(n);function n(t){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),(i=e.call(this,640,151,t)).item.y=489,i.item.x=0,i.item.frame=0,i.image=i.game.assets["img/grand.png"],L(i,I(i))}return n}(o);function B(t){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function j(t,e){return(j=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=G(t);if(e){var r=G(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return X(this,n)}}function X(t,e){return!e||"object"!==B(e)&&"function"!=typeof e?Y(t):e}function Y(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function G(t){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var H=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&j(t,e)}(o,t);var e,n,i,r=F(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,50,50,t)).item.y=550,e.item.x=500,e.item.scale(2),e.item.on("touchstart",(function(){return e.touchstart()})),e.item.on("touchend",(function(){return e.touchend()})),e.player=e.controller.items.prayer,e.image=e.game.assets["img/btn_jump.png"],X(e,Y(e))}return e=o,(n=[{key:"on",value:function(){}},{key:"touchstart",value:function(){this.player.touchstart()}},{key:"touchend",value:function(){this.player.touchend()}}])&&U(e.prototype,n),i&&U(e,i),o}(o);function z(t){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function V(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function q(t,e){return(q=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Q(t);if(e){var r=Q(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return K(this,n)}}function K(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?J(t):e}function J(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q(t){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Z=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&q(t,e)}(o,t);var e,n,i,r=W(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,251,127,t)).item.y=500,e.item.x=891,e.item.scale(.2),e.image=e.game.assets["img/rook.png"],K(e,J(e))}return e=o,(n=[{key:"move",value:function(t){this.item.x+=t}},{key:"on",value:function(){this.move(this.controller.scroll())}}])&&V(e.prototype,n),i&&V(e,i),o}(o);function $(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var tt=function(){function t(e,n,i){var r=this;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.controller=i,this.item=new Sprite(e,n),this.item.x=0,this.item.y=0,this.game=i.game,this.item.on("enterframe",(function(){return r.on()})),this}var e,n,r;return e=t,(n=[{key:"move",value:function(t){this.item.x+=t}},{key:"on",value:function(){this.move(this.controller.scroll())}},{key:"random",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i(t,e)}},{key:"apply",value:function(t){return this.item.image=this.image,this.group=t,t.addChild(this.item),this}},{key:"remove",value:function(){return this.group?(this.group.removeChild(this.item),this):this}}])&&$(e.prototype,n),r&&$(e,r),t}();function et(t){return(et="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function it(t,e){return(it=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function rt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=at(t);if(e){var r=at(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return ot(this,n)}}function ot(t,e){return!e||"object"!==et(e)&&"function"!=typeof e?st(t):e}function st(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function at(t){return(at=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ht=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&it(t,e)}(o,t);var e,n,i,r=rt(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,25,33,t)).item.y=462;var n=260;return 2===e.controller.mode&&(n=235),3===e.controller.mode&&(n=220),e.item.x=n,e.item.scale(2.5),e.item.scaleX=-2.5,e.item.frame=[0,1,2],e.image=e.game.assets["img/koka_ninja.png"],e.defaultRunSpeed=.4,e.runSpeed=e.defaultRunSpeed,e.SPEED_FLG=0,ot(e,st(e))}return e=o,(n=[{key:"move",value:function(){this.controller.isSecond()&&this.oneSecond(),this.item.x+=this.runSpeed}},{key:"oneSecond",value:function(){this.SPEED_FLG>0&&(this.SPEED_FLG-=1),0===this.SPEED_FLG&&(this.runSpeed=this.defaultRunSpeed)}},{key:"on",value:function(){this.move(),this.controller.intersectPrayer(this.item)&&this.controller.clear(),this.item.x>650&&this.controller.over()}}])&&nt(e.prototype,n),i&&nt(e,i),o}(tt);function ct(t){return(ct="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function lt(t,e){return(lt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ft(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=pt(t);if(e){var r=pt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return dt(this,n)}}function dt(t,e){return!e||"object"!==ct(e)&&"function"!=typeof e?mt(t):e}function mt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function pt(t){return(pt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var _t=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&lt(t,e)}(o,t);var e,n,i,r=ft(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,150,150,t)).item.y=e,i.item.x=n,i.item.scale(-.8),i.item.frame=0,i.item.image=i.game.assets["img/bakuhatsu3.png"],i.controller.scene.addChild(i.item),i.soundEffect=i.game.assets["bgm/panti.mp3"].clone(),i.item.on("enterframe",(function(){return i.on()})),i.soundEffect.play(),dt(i,mt(i))}return e=o,(n=[{key:"on",value:function(){this.controller.isSecond()&&this.remove()}},{key:"apply",value:function(){return this}},{key:"remove",value:function(){return this.controller.scene.removeChild(this.item),this}}])&&ut(e.prototype,n),i&&ut(e,i),o}(tt);function vt(t){return(vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function gt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function yt(t,e){return(yt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Et(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=St(t);if(e){var r=St(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return bt(this,n)}}function bt(t,e){return!e||"object"!==vt(e)&&"function"!=typeof e?wt(t):e}function wt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function St(t){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ct=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&yt(t,e)}(o,t);var e,n,i,r=Et(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,25,25,t)).item.y=470,e.item.x=665,e.item.scale(2.8),e.item.frame=[0,1,2],e.image=e.game.assets["img/ashigaru.png"],e.runSpeed=-1,e.isJump=!1,e.GROUND_Y=470,bt(e,wt(e))}return e=o,(n=[{key:"move",value:function(t){this.item.x+=t+this.runSpeed}},{key:"on",value:function(){this.move(this.controller.scroll()),this.jump();var t=this.controller.items.prayer,e=this.controller.items.boss;this.controller.intersectPrayer(this.item)&&(this.controller.SCROLL_SPEED=0,this.controller.SCROLL_FLG=1,t.slowRun(),e.runSpeed=4,e.SPEED_FLG=1,new _t(this.controller,this.item.y-55,this.item.x-65),this.item.remove())}},{key:"jump",value:function(){1===this.random(1,35)&&2<this.controller.mode&&(this.isJump||(this.isJump=!0,this.vy=this.random(-10,-15))),this.isJump&&(this.vy+=1,this.item.y+=this.vy,this.item.frame=0,this.item.y>=this.GROUND_Y&&(this.item.y=this.GROUND_Y,this.isJump=!1,this.item.frame=[0,1,2]))}}])&&gt(e.prototype,n),i&&gt(e,i),o}(tt);function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ot(t,e){return(Ot=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=Rt(t);if(e){var r=Rt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Mt(this,n)}}function Mt(t,e){return!e||"object"!==xt(e)&&"function"!=typeof e?At(t):e}function At(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Rt(t){return(Rt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ot(t,e)}(o,t);var e,n,i,r=Nt(o);function o(t,e,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=r.call(this,150,150,t)).item.y=e,i.item.x=n,i.item.scale(-.8),i.item.frame=0,i.item.image=i.game.assets["img/bakuhatsu1.png"],i.controller.scene.addChild(i.item),i.soundEffect=i.game.assets["bgm/bakuhatu.mp3"].clone(),i.item.on("enterframe",(function(){return i.on()})),i.soundEffect.play(),Mt(i,At(i))}return e=o,(n=[{key:"on",value:function(){this.controller.isSecond()&&this.remove()}},{key:"apply",value:function(){return this}},{key:"remove",value:function(){return this.controller.scene.removeChild(this.item),this}}])&&Tt(e.prototype,n),i&&Tt(e,i),o}(tt);function Lt(t){return(Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function It(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Pt(t,e){return(Pt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function kt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,i=jt(t);if(e){var r=jt(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return Bt(this,n)}}function Bt(t,e){return!e||"object"!==Lt(e)&&"function"!=typeof e?Ut(t):e}function Ut(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pt(t,e)}(o,t);var e,n,i,r=kt(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=r.call(this,39,25,t)).item.y=e.random(380,460),e.item.x=620,e.item.scale(1.5),e.item.frame=[0,1],e.image=e.game.assets["img/hinotama.png"],e.runSpeed=-10,e.flg=!1,Bt(e,Ut(e))}return e=o,(n=[{key:"move",value:function(){this.item.x+=this.runSpeed,this.item.y+=this.random(-10,10),this.item.y>460&&(this.item.y=460),this.item.y>380&&(this.item.y=380)}},{key:"getDegree",value:function(t,e,n){return(n%=e)<t&&(n+=e),n}},{key:"on",value:function(){this.move(),this.flg&&this.controller.over(),this.controller.intersectPrayer(this.item)&&(new Dt(this.controller,this.item.y-55,this.item.x-65),this.flg=!0)}}])&&It(e.prototype,n),i&&It(e,i),o}(tt);function Xt(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:26,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"left",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"#333",a=new Label(i);return a.x=e,a.y=n,a.font="".concat(r,"px sans-serif"),a.textAlign=o,a.color=s,a}var Yt=[{class:"Ashigaru",count:1,mode:1},{class:"Hinotama",count:3,mode:1},{class:"Hinotama",count:6,mode:1},{class:"Ashigaru",count:5,mode:1},{class:"Hinotama",count:9,mode:1},{class:"Ashigaru",count:9,mode:1},{class:"Ashigaru",count:10,mode:2},{class:"Hinotama",count:11,mode:1},{class:"Hinotama",count:12,mode:2},{class:"Hinotama",count:13,mode:3},{class:"Ashigaru",count:13,mode:1},{class:"Ashigaru",count:14,mode:2},{class:"Hinotama",count:14,mode:3},{class:"Hinotama",count:15,mode:3},{class:"Ashigaru",count:17,mode:1},{class:"Hinotama",count:18,mode:2},{class:"Hinotama",count:20,mode:3},{class:"Ashigaru",count:21,mode:2},{class:"Hinotama",count:22,mode:1},{class:"Ashigaru",count:23,mode:3},{class:"Ashigaru",count:24,mode:1},{class:"Ashigaru",count:25,mode:2},{class:"Hinotama",count:26,mode:3},{class:"Ashigaru",count:27,mode:2},{class:"Hinotama",count:28,mode:1},{class:"Ashigaru",count:29,mode:2},{class:"Ashigaru",count:29,mode:2},{class:"Hinotama",count:30,mode:2},{class:"Hinotama",count:30,mode:3},{class:"Hinotama",count:30,mode:3}];function Gt(t,e,n,i,r){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=new Sprite(t,e);return s.image=n,s.x=i,s.y=r,s.scale(o),s}function Ht(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var zt=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),console.log("Main.constructor"),this.game=null,this.SCROLL_SPEED=-10,this.SCROLL_FLG=0}var e,n,r;return e=t,(n=[{key:"init",value:function(t){var e=this;console.log("Main.init"),this.fps=24,this.game=t,this.game.fps=this.fps,this.game.onload=function(){return e.load()},this.game.on("enterframe",(function(){return e.on()})),this.items={},this.asset={},this.flameCount=0,this.second=0,this.scene=null,this.gameStart=!1,this.restart=0}},{key:"hookAdd",value:function(t,e){var n=this;this.enemysClass[t]=function(t){return new e(n).apply(t)}}},{key:"enemyApply",value:function(t,e){var n=this.enemysClass[t];if(n)return n(e)}},{key:"facade",value:function(){console.log("Main.facade"),this.enemysClass={},this.game.preload("img/ninja.png","img/btn_jump.png","img/kawa.png","img/cloud.png","img/mountain.png","img/grand.png","img/wind.png","img/rook.png","img/musha.png","img/ashigaru.png","img/hinotama.png","img/bakuhatsu3.png","img/bakuhatsu1.png","bgm/se_maoudamashii_retro08.mp3","bgm/MusMus-BGM-122.mp3","bgm/MusMus-BGM-115.mp3","bgm/MusMus-BGM-104.mp3","bgm/panti.mp3","bgm/bakuhatu.mp3","img/koka_ninja.png","img/gameover.png","img/game_clear.png","img/password_makimono.png","img/password_introduction2.png","img/taphere.png"),this.hookAdd("Ashigaru",Ct),this.hookAdd("Hinotama",Ft)}},{key:"on",value:function(){var t=this;if(console.log("Main.on"),this.gameStart){this.flameCount+=1,this.isSecond()&&(this.second+=1),this.isSecond()&&this.SCROLL_FLG>0&&(this.SCROLL_FLG-=1),this.isSecond()&&0===this.SCROLL_FLG&&(this.SCROLL_SPEED=-10),this.isSecond()&&Yt.filter((function(e){return e.count===t.second})).filter((function(e){return e.mode<=t.mode})).map((function(e){return t.enemyApply(e.class,t.charaGroup)}));var e=this.isSecond();e&&1===i(1,3)&&new b(this).apply(this.bgGroup),e&&1===i(1,4)&&new b(this).apply(this.bgGroup),e&&1===i(1,5)&&new M(this).apply(this.bgGroup),e&&1===i(1,5)&&new Z(this).apply(this.bgGroup)}}},{key:"isSecond",value:function(){return this.flameCount%this.fps==0}},{key:"timerInit",value:function(){this.flameCount=0,this.second=0}},{key:"removeScene",value:function(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}},{key:"replaceScene",value:function(t){this.game.replaceScene(t),this.scene=t}},{key:"titleScene",value:function(t){var e=this;this.removeScene(t),this.bgm&&this.bgm.stop();var n=new Scene;n.addChild(Xt(n,180,200,"武者を捕まえろ",27,"center","#ffffff")),n.addChild(Xt(n,180,250,"難易度選択でゲーム開始",27,"center","#ffffff"));var i=Xt(n,180,340,"かんたん",27,"center","#ffffff"),r=Xt(n,180,400,"ふつー",27,"center","#ffffff"),o=Xt(n,180,460,"むずかしい",27,"center","#ffffff");n.addChild(i),n.addChild(r),n.addChild(o),i.on("touchstart",(function(){return e.gameScene(n,1)})),r.on("touchstart",(function(){return e.gameScene(n,2)})),o.on("touchstart",(function(){return e.gameScene(n,3)})),n.backgroundColor="#4a62e6",this.replaceScene(n);var s=new Group;n.addChild(s)}},{key:"gameScene",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;this.mode=e,this.removeScene(t),this.timerInit();var n=new Scene;this.bgm=this.game.assets["bgm/MusMus-BGM-122.mp3"].clone(),this.bgm.play(),this.replaceScene(n),n.backgroundColor="#4a62e6";var i=new Group,r=new Group,o=new Group;this.items.prayer=new d(this).apply(o),this.items.boss=new ht(this).apply(o),this.items.jumpBtn=new H(this).apply(i),new k(this).apply(r),new b(this).init().apply(r),new b(this).init().apply(r),new M(this).init().apply(r),new Z(this).apply(r),n.addChild(r),n.addChild(o),n.addChild(i),this.bgGroup=r,this.charaGroup=o,this.gameStart=!0}},{key:"overScene",value:function(t){var e=this;this.removeScene(t);var n=new Scene;n.backgroundColor="#333",n.addChild(Xt(n,170,250,"GAME OVER",40,"center","#ffffff")),n.addChild(Xt(n,180,400,"タッチでリトライ",30,"center","#ffffff")),n.on("touchstart",(function(){return e.titleScene()})),this.replaceScene(n),this.bgm&&this.bgm.stop(),this.bgm=this.game.assets["bgm/MusMus-BGM-104.mp3"].clone(),this.bgm.play()}},{key:"clearScene",value:function(t){var e=this;this.removeScene(t);var n=new Scene;n.addChild(Xt(n,160,280,"GAME CLEAR",30,"center")),n.addChild(Xt(n,190,330,"タイム ".concat(this.second,"秒"),30,"center")),n.addChild(Xt(n,160,380,"リスタート".concat(this.restart,"回"),30,"center")),n.on("touchstart",(function(){return e.gameclearScene()})),this.replaceScene(n)}},{key:"gameclearScene",value:function(t){this.removeScene(t);var e=new Scene;e.backgroundColor="black",e.addChild(Gt(126,24,this.game.assets["img/game_clear.png"],265,95,2)),e.addChild(Gt(100,70,this.game.assets["img/password_makimono.png"],270,215,2)),e.addChild(Gt(65,18,this.game.assets["img/password_introduction2.png"],296,332,2));var n=new Sprite(127,25);n.image=this.game.assets["img/taphere.png"],n.x=260,n.y=490,n.scale(2),n.opacity=.08;var i=0;n.onenterframe=function(){n.opacity<1&&0==i?n.opacity+=.08:(n.opacity>=1&&(i=1),n.opacity<=0&&(i=0),n.opacity-.08<0?n.opacity=0:n.opacity-=.08)},e.addChild(n),n.on("touchstart",(function(){return window.location.href="https://genmakai.github.io/site/"}));var r=Xt(e,300,224,"き",32,"left");r.color="black",r.font="64px 'Meiryo', 'メイリオ', 'ヒラギノ角ゴ Pro W3', sans-serif",e.addChild(r),this.replaceScene(e)}},{key:"endScene",value:function(t){var e=this;this.removeScene(t);var n=new Scene;n.addChild(Xt(n,280,80,"使用素材",26,"left")),n.addChild(Xt(n,220,180,"フリーBGM・音楽素材MusMus <br>https://musmus.main.jp/<br>・Mid-range Strength<br>・隠密ファンク<br>・希望の青",16,"left")),n.on("touchstart",(function(){return e.titleScene()})),this.replaceScene(n)}},{key:"intersectPrayer",value:function(t){var e=this.getData(this.items,"prayer.item");return!!e&&e.intersect(t)}},{key:"start",value:function(){console.log("メイン処理開始"),this.titleScene(),this.game.start()}},{key:"stop",value:function(){console.log("メイン処理停止"),this.game.stop(),this.gameStart=!1}},{key:"over",value:function(){this.overScene(),this.restart+=1,this.gameStart=!1}},{key:"clear",value:function(){console.log("スクリーンクリア"),this.gameclearScene(),this.gameStart=!1}},{key:"load",value:function(){console.log("メイン読み込み")}},{key:"scroll",value:function(){return this.SCROLL_SPEED}},{key:"getData",value:function(t,e,n){if(!t)return null;var i=e.split("."),r=t;try{return i.map((function(t){var e=r[t];r=e})),r}catch(t){return n}}}])&&Ht(e.prototype,n),r&&Ht(e,r),t}());enchant(),window.main=zt,window.onload=function(){console.log("読み込み完了");var t=new Core(640,640);zt.init(t),zt.facade(),zt.start()}},function(t,e){}]);
//# sourceMappingURL=app.js.map