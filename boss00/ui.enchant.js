function rand(t){return Math.floor(Math.random()*t)}enchant.ui={assets:["pad.png","apad.png","icon0.png","font0.png"]},enchant.ui.Pad=enchant.Class.create(enchant.Sprite,{initialize:function(){var t=enchant.Core.instance.assets["pad.png"];enchant.Sprite.call(this,t.width/2,t.height),this.image=t,this.input={left:!1,right:!1,up:!1,down:!1},this.addEventListener("touchstart",(function(t){this._updateInput(this._detectInput(t.localX,t.localY))})),this.addEventListener("touchmove",(function(t){this._updateInput(this._detectInput(t.localX,t.localY))})),this.addEventListener("touchend",(function(t){this._updateInput({left:!1,right:!1,up:!1,down:!1})}))},_detectInput:function(t,i){var e={left:!1,right:!1,up:!1,down:!1};return(t-=.5*this.width)*t+(i-=.5*this.height)*i<=2500&&t*t+i*i>200&&(t<0&&i<t*t*.1&&i>t*t*-.1&&(e.left=!0),t>0&&i<t*t*.1&&i>t*t*-.1&&(e.right=!0),i<0&&t<i*i*.1&&t>i*i*-.1&&(e.up=!0),i>0&&t<i*i*.1&&t>i*i*-.1&&(e.down=!0)),e},_updateInput:function(t){var i=enchant.Core.instance;["left","right","up","down"].forEach((function(e){this.input[e]&&!t[e]&&i.changeButtonState(e,!1),!this.input[e]&&t[e]&&i.changeButtonState(e,!0)}),this),this.input=t}}),enchant.ui.APad=enchant.Class.create(enchant.Group,{initialize:function(t){var i=enchant.Core.instance.assets["apad.png"],e=this.width=i.width,h=this.height=i.height;enchant.Group.call(this),this.outside=new enchant.Sprite(e,h);var n=new enchant.Surface(e,h);n.draw(i,0,0,e,h/4,0,0,e,h/4),n.draw(i,0,h/4*3,e,h/4,0,h/4*3,e,h/4),n.draw(i,0,h/4,e/4,h/2,0,h/4,e/4,h/2),n.draw(i,e/4*3,h/4,e/4,h/2,e/4*3,h/4,e/4,h/2),this.outside.image=n,this.inside=new enchant.Sprite(e/2,h/2);var s=new enchant.Surface(e/2,h/2);s.draw(i,e/4,h/4,e/2,h/2,0,0,e/2,h/2),this.inside.image=s,this.r=e/2,this.isTouched=!1,this.vx=0,this.vy=0,this.rad=0,this.dist=0,this.mode="direct"===t?"direct":"normal",this._updateImage(),this.addChild(this.inside),this.addChild(this.outside),this.addEventListener("touchstart",(function(t){this._detectInput(t.localX,t.localY),this._calcPolar(t.localX,t.localY),this._updateImage(t.localX,t.localY),this._dispatchPadEvent("apadstart"),this.isTouched=!0})),this.addEventListener("touchmove",(function(t){this._detectInput(t.localX,t.localY),this._calcPolar(t.localX,t.localY),this._updateImage(t.localX,t.localY),this._dispatchPadEvent("apadmove")})),this.addEventListener("touchend",(function(t){this._detectInput(this.width/2,this.height/2),this._calcPolar(this.width/2,this.height/2),this._updateImage(this.width/2,this.height/2),this._dispatchPadEvent("apadend"),this.isTouched=!1}))},_dispatchPadEvent:function(t){var i=new enchant.Event(t);i.vx=this.vx,i.vy=this.vy,i.rad=this.rad,i.dist=this.dist,this.dispatchEvent(i)},_updateImage:function(t,i){this.width,this.height,this.inside.x=this.vx*(this.r-10)+25,this.inside.y=this.vy*(this.r-10)+25},_detectInput:function(t,i){t-=this.width/2,i-=this.height/2;var e=Math.sqrt(t*t+i*i),h=i/t,n=Math.atan(h),s=t/Math.abs(t);0===e?(this.vx=0,this.vy=0):0===t?(this.vx=0,"direct"===this.mode?this.vy=i/this.r:(s=i/Math.abs(i),this.vy=Math.pow(i/this.r,2)*s)):e<this.r?"direct"===this.mode?(this.vx=t/this.r,this.vy=i/this.r):(this.vx=Math.pow(e/this.r,2)*Math.cos(n)*s,this.vy=Math.pow(e/this.r,2)*Math.sin(n)*s):(this.vx=Math.cos(n)*s,this.vy=Math.sin(n)*s)},_calcPolar:function(t,i){t-=this.width/2,i-=this.height/2;var e=0,h=0,n=Math.sqrt(t*t+i*i);n>this.r&&(n=this.r),n/=this.r,"normal"===this.mode&&(n*=n),t>=0&&i<0?(e=Math.PI/2*3,h=t/i):t<0&&i<=0?(e=Math.PI,h=i/t):t<=0&&i>0?(e=Math.PI/2,h=t/i):t>0&&i>=0&&(e=0,h=i/t),0!==t&&0!==i||(h=0),this.rad=Math.abs(Math.atan(h))+e,this.dist=n}}),enchant.ui.Button=enchant.Class.create(enchant.Entity,{initialize:function(t,i,e,h){enchant.Entity.call(this),enchant.CanvasLayer&&(this._element="div"),this.width=h||null,this.height=e||null,this.text=t,this.pressed=!1;var n=this._style;n.display="inline-block",n["font-size"]="12px",n.height="2em",n["line-height"]="2em",n["min-width"]="2em",n.padding="2px 10px",n["text-align"]="center",n["font-weight"]="bold",n["border-radius"]="0.5em",i=i||"dark",this.theme="string"==typeof i?enchant.ui.Button.DEFAULT_THEME[i]:i,this._applyTheme(this.theme.normal),this.addEventListener("touchstart",(function(){this._applyTheme(this.theme.active),this.pressed=!0,this.y++})),this.addEventListener("touchend",(function(){this._applyTheme(this.theme.normal),this.pressed=!1,this.y--}))},_applyTheme:function(t){var i=this._style,e=enchant.ui.Button.theme2css(t);for(var h in e)e.hasOwnProperty(h)&&(i[h]=e[h])},text:{get:function(){return this._text},set:function(t){this._text=t,enchant.CanvasLayer||(this._element.innerHTML=t)}},size:{get:function(){return this._style.fontSize},set:function(t){this._style.fontSize=t}},font:{get:function(){return this._style.font},set:function(t){this._style.font=t}},color:{get:function(){return this._style.color},set:function(t){this._style.color=t}},cvsRender:function(){},domRender:function(){var t=this._domManager.element;t.innerHTML=this._text,t.style.font=this._font,t.style.color=this._color,t.style.textAlign=this._textAlign}}),enchant.ui.Button.theme2css=function(t){var i="-"+enchant.ENV.VENDOR_PREFIX.toLowerCase()+"-",e={},h=t.background,n=t.border,s=t.textShadow,a=t.boxShadow;return"-ms-"===i?e.background=h.start:e["background-image"]=i+h.type+"("+["top",h.start,h.end]+")",e.color=t.color,e.border=n.color+" "+n.width+" "+n.type,e["text-shadow"]=s.offsetX+"px "+s.offsetY+"px "+s.blur+" "+s.color,e["box-shadow"]=a.offsetX+"px "+a.offsetY+"px "+a.blur+" "+a.color,e},enchant.ui.Button.DEFAULT_THEME={dark:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#666",end:"#333"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#333",end:"#000"},border:{color:"#333",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},light:{normal:{color:"#333",background:{type:"linear-gradient",start:"#fff",end:"#ccc"},border:{color:"#999",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#fff"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 1)"}},active:{color:"#333",background:{type:"linear-gradient",start:"#ccc",end:"#999"},border:{color:"#666",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#ccc"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(255, 255, 255, 0.3)"}}},blue:{normal:{color:"#fff",background:{type:"linear-gradient",start:"#04f",end:"#04c"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#666"},boxShadow:{offsetX:0,offsetY:1,blur:0,color:"rgba(0, 0, 0, 0.5)"}},active:{color:"#ccc",background:{type:"linear-gradient",start:"#029",end:"#026"},border:{color:"#026",width:1,type:"solid"},textShadow:{offsetX:0,offsetY:1,blur:0,color:"#000"},boxShadow:"none"}}},enchant.ui.MutableText=enchant.Class.create(enchant.Sprite,{initialize:function(t,i,e){enchant.Sprite.call(this,0,0),this.fontSize=16,this.widthItemNum=16,this.x=t,this.y=i,this._imageAge=Number.MAX_VALUE,this.text="",arguments[2]&&(this.row=Math.floor(arguments[2]/this.fontSize))},setText:function(t){var i,e,h,n,s;for(this._text=t,this.returnLength?this.width=Math.min(this.returnLength*this.fontSize,enchant.Game.instance.width):this.width=Math.min(this.fontSize*this._text.length,enchant.Game.instance.width),this.height=this.fontSize*(Math.ceil(this._text.length/this.row)||1),!this.image||this.width>this.image.width||this.height>this.image.height||this._imageAge>300?(this.image=new enchant.Surface(this.width,this.height),this._imageAge=0):this.width<this.image.width||this.height<this.image.height?this._imageAge++:this._imageAge=0,this.image.context.clearRect(0,0,this.width,this.height),i=0;i<t.length;i++)e=(s=(n=t.charCodeAt(i))>=32&&n<=127?n-32:0)%this.widthItemNum,h=s/this.widthItemNum|0,this.image.draw(enchant.Game.instance.assets["font0.png"],e*this.fontSize,h*this.fontSize,this.fontSize,this.fontSize,i%this.row*this.fontSize,(i/this.row|0)*this.fontSize,this.fontSize,this.fontSize)},text:{get:function(){return this._text},set:function(t){this.setText(t)}},row:{get:function(){return this.returnLength||this.width/this.fontSize},set:function(t){this.returnLength=t,this.text=this.text}}}),enchant.ui.ScoreLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(t,i){switch(enchant.ui.MutableText.call(this,0,0),arguments.length){case 2:this.y=i,this.x=t;break;case 1:this.x=t}this._score=0,this._current=0,this.easing=2.5,this.text=this.label="SCORE:",this.addEventListener("enterframe",(function(){if(0===this.easing)this.text=this.label+(this._current=this._score);else{var t=this._score-this._current;0<t?this._current+=Math.ceil(t/this.easing):t<0&&(this._current+=Math.floor(t/this.easing)),this.text=this.label+this._current}}))},score:{get:function(){return this._score},set:function(t){this._score=t}}}),enchant.ui.TimeLabel=enchant.Class.create(enchant.ui.MutableText,{initialize:function(t,i,e){switch(enchant.ui.MutableText.call(this,0,0),arguments.length){case 3:case 2:this.y=i,this.x=t;break;case 1:this.x=t}this._time=0,this._count=1,"countdown"===e&&(this._count=-1),this.text=this.label="TIME:",this.addEventListener("enterframe",(function(){this._time+=this._count,this.text=this.label+(this._time/enchant.Game.instance.fps).toFixed(2)}))},time:{get:function(){return Math.floor(this._time/enchant.Game.instance.fps)},set:function(t){this._time=t*enchant.Game.instance.fps}}}),enchant.ui.LifeLabel=enchant.Class.create(enchant.Group,{initialize:function(t,i,e){enchant.Group.call(this),this.x=t||0,this.y=i||0,this._maxlife=e||9,this._life=0,this.label=new enchant.ui.MutableText(0,0,80),this.label.text="LIFE:",this.addChild(this.label),this.heart=[];for(var h=0;h<this._maxlife;h++)this.heart[h]=new enchant.Sprite(16,16),this.heart[h].image=enchant.Game.instance.assets["icon0.png"],this.heart[h].x=this.label.width+16*h,this.heart[h].y=-3,this.heart[h].frame=10,this.addChild(this.heart[h])},life:{get:function(){return this._life},set:function(t){this._life=t,this._maxlife<t&&(this._life=this._maxlife);for(var i=0;i<this._maxlife;i++)this.heart[i].visible=i<=t-1}}}),enchant.ui.Bar=enchant.Class.create(enchant.Sprite,{initialize:function(t,i){switch(enchant.Sprite.call(this,1,16),this.image=new enchant.Surface(1,16),this.image.context.fillColor="RGB(0, 0, 256)",this.image.context.fillRect(0,0,1,16),this._direction="right",this._origin=0,this._maxvalue=enchant.Game.instance.width,this._lastvalue=0,this.value=0,this.easing=5,arguments.length){case 2:this.y=i,this.x=t,this._origin=t;break;case 1:this.x=t,this._origin=t}this.addEventListener("enterframe",(function(){this.value<0&&(this.value=0),this._lastvalue+=(this.value-this._lastvalue)/this.easing,Math.abs(this._lastvalue-this.value)<1.3&&(this._lastvalue=this.value),this.width=0|this._lastvalue,this.width>this._maxvalue&&(this.width=this._maxvalue),"left"===this._direction?this._x=this._origin-this.width:this._x=this._origin,this._updateCoordinate()}))},direction:{get:function(){return this._direction},set:function(t){"right"!==t&&"left"!==t||(this._direction=t)}},x:{get:function(){return this._origin},set:function(t){this._x=t,this._origin=t,this._dirty=!0}},maxvalue:{get:function(){return this._maxvalue},set:function(t){this._maxvalue=t}}}),enchant.ui.VirtualMap=enchant.Class.create(enchant.Group,{initialize:function(t,i){enchant.Group.call(this),this.meshWidth=t||16,this.meshHeight=i||16},addChild:function(t){enchant.Group.prototype.addChild.call(this,t),this.bind(t)},insertBefore:function(t,i){enchant.Group.prototype.insertBefore.call(this,t,i),this.bind(t)},bind:function(t){Object.defineProperties(t,{mx:{get:function(){return Math.floor(this.x/this.parentNode.meshWidth)},set:function(t){this.x=Math.floor(t*this.parentNode.meshWidth)}},my:{get:function(){return Math.floor(this.y/this.parentNode.meshHeight)},set:function(t){this.y=Math.floor(t*this.parentNode.meshWidth)}}}),t.mx=0,t.my=0}});
